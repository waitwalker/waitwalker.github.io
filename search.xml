<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>iOSä¸­Objective-Cå’ŒSwiftæ··ç¼–åŠç¬¬ä¸‰æ–¹æ¡†æ¶ç›¸äº’è°ƒç”¨</title>
      <link href="/2019/04/07/iOS%E4%B8%ADObjective-C%E5%92%8CSwift%E6%B7%B7%E7%BC%96%E5%8F%8A%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8/"/>
      <url>/2019/04/07/iOS%E4%B8%ADObjective-C%E5%92%8CSwift%E6%B7%B7%E7%BC%96%E5%8F%8A%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6%E7%9B%B8%E4%BA%92%E8%B0%83%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»ä¸€ä¸‹OCå’Œswiftæ··ç¼–é—®é¢˜,å…¶ä¸­æ¶‰åŠä¸¤å¤§éƒ¨åˆ†:1)océ¡¹ç›®ä¸­æ··ç¼–swiftçš„å®ç°; 2)ocæˆ–è€…swiftç¬¬ä¸‰åº“çš„å¯¼å…¥åŠä½¿ç”¨.</p><p>#1 océ¡¹ç›®ä¸­æ··ç¼–swift<br>åœ¨océ¡¹ç›®ä¸­æƒ³è¦ä½¿ç”¨swift,å¹¶ä¸”å®ç°ç›¸äº’è°ƒç”¨,éœ€è¦ä¸€äº›åŸºæœ¬çš„è®¾ç½®,æ¡¥æ¥æ–‡ä»¶ä¹Ÿæ˜¯å¿…é¡»å¾—.</p><p>#1. 1 åŸºæœ¬è®¾ç½®æ”¯æŒswift<br>åœ¨bulid settingä¸­æ‰¾åˆ° Packaging ä¸‹çš„ define module,å°†æ˜¯å¦å®šä¹‰æ¨¡å—å¸ƒå°”å€¼æ”¹æˆYES,è¿™æ ·OCå°±å¯ä»¥æ”¯æŒswiftäº†.<br><img src="http://upload-images.jianshu.io/upload_images/1715253-a50523996ab98cb0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="define module.png"></p><p>#1. 2 åˆ›å»ºæ¡¥æ¥æ–‡ä»¶<br>æ¡¥æ¥æ–‡ä»¶å¯ä»¥åœ¨ä½ åˆ›å»ºswiftæ–‡ä»¶çš„æ—¶å€™Xcodeè‡ªåŠ¨ç”Ÿæˆ,ä¹Ÿå¯ä»¥è‡ªå·±æ‰‹åŠ¨åˆ›å»º,æ‰‹åŠ¨åˆ›å»ºä¹Ÿå°±æ˜¯ä¸€ä¸ªå¤´æ–‡ä»¶(.hæ–‡ä»¶).<br>è¿™é‡Œéœ€è¦è¯´æ˜ä¸€ç‚¹çš„æ˜¯,åœ¨océ¡¹ç›®ä¸­åˆ›å»ºçš„swiftæ–‡ä»¶å¿…é¡»éƒ½è¦ç»§æ‰¿è‡ªNSObjectåŸºç±»,è€Œä½ è‡ªå·±æƒ³è¦åˆ›å»ºçš„ä¸€äº›ç±»å¯ä»¥è¿™æ ·æ¥åˆ›å»º:</p><p>####åˆ›å»ºæ­¥éª¤1<br><img src="http://upload-images.jianshu.io/upload_images/1715253-6cacd2bc47564e79.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1.png"></p><p>####åˆ›å»ºæ­¥éª¤2<br><img src="http://upload-images.jianshu.io/upload_images/1715253-fd2a1b324f032568.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.png"></p><p>####åˆ›å»ºæ­¥éª¤3<br>è¿™é‡Œé€‰æ‹©Create Bridging Header,å¦‚æœä¸é€‰çš„è¯,é‚£å°±è‡ªå·±æ‰‹åŠ¨åˆ›å»º,ç„¶åæŒ‡å®šç´¢å¼•ä½ç½®<br><img src="http://upload-images.jianshu.io/upload_images/1715253-e88dda48a82bc616.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.png"></p><p>####åˆ›å»ºæ­¥éª¤4<br><img src="http://upload-images.jianshu.io/upload_images/1715253-19219fab149a7ca7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.png"><br>ç¬¬ä¸‰æ­¥ä¸­å¦‚æœæ²¡æœ‰åˆ›å»ºæ¡¥æ¥æ–‡ä»¶çš„è¯,æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªæ¡¥æ¥æ–‡ä»¶,ç„¶åbuild setting ä¸­æœç´¢ Objective-C Bridging Header,å°†ä½ æ‰‹åŠ¨åˆ›å»ºçš„æ¡¥æ¥æ–‡ä»¶è·¯å¾„è¾“å…¥è¿›å»</p><p>####æ¡¥æ¥æ–‡ä»¶è®¾ç½®<br><img src="http://upload-images.jianshu.io/upload_images/1715253-b9b8484bfd32bc58.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ¡¥æ¥æ–‡ä»¶è®¾ç½®"></p><p>#1.3 swiftä¸­è°ƒç”¨ocæ–‡ä»¶<br>ç°åœ¨åŸºæœ¬ä¸Šå¯ä»¥å®ç°swiftè°ƒç”¨ocä¸­ä»£ç äº†,é¦–å…ˆåœ¨æ¡¥æ¥æ–‡ä»¶ä¸­å¯¼å…¥ä½ æƒ³åœ¨swiftä¸­ç”¨åˆ°çš„ocç±»</p><p>####å¯¼å…¥ocç±»<br><img src="http://upload-images.jianshu.io/upload_images/1715253-1228e43af95e8399.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¯¼å…¥ocç±»"></p><p>####ä½¿ç”¨ocä¸­çš„ç±»<br><img src="http://upload-images.jianshu.io/upload_images/1715253-2b410f5097f1786c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä½¿ç”¨ocä¸­çš„ç±»"></p><p>#1. 4 ocä¸­è°ƒç”¨swiftæ–‡ä»¶<br><img src="http://upload-images.jianshu.io/upload_images/1715253-25d7b46b350c3dda.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ocä¸­è°ƒç”¨swiftæ–‡ä»¶"></p><p>#2 ocå’Œswiftç¬¬ä¸‰æ–¹åº“çš„ä½¿ç”¨<br>å¦‚æœä½ çš„é¡¹ç›®ç”¨cocoapodsæ¥ç®¡ç†ä½ ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹åº“,å¹¶ä¸”OCé¡¹ç›®ä¸­å·²ç»é›†æˆäº†å¤šä¸ªç¬¬ä¸‰æ–¹åº“,é‚£ä¹ˆè¿™æ—¶ä½ æƒ³åœ¨å¯¼å…¥swiftç¼–å†™çš„ç¬¬ä¸‰æ–¹åº“,è¿™æ—¶ä½ ä¸èƒ½ç”¨cocoapodsç®¡ç†ç¬¬ä¸‰æ–¹åº“äº†,å› ä¸ºSwiftè¿æ¥æ—¶ä¸æ”¯æŒé™æ€åº“,cocoapodsä¹Ÿåœ¨å…¶Podfileä¸­æœ‰è¯´æ˜:</p><h1 id="Uncomment-the-next-line-if-youâ€™re-using-Swift-or-would-like-to-use-dynamic-frameworks"><a href="#Uncomment-the-next-line-if-youâ€™re-using-Swift-or-would-like-to-use-dynamic-frameworks" class="headerlink" title="Uncomment the next line if youâ€™re using Swift or would like to use dynamic frameworks"></a>Uncomment the next line if youâ€™re using Swift or would like to use dynamic frameworks</h1><h1 id="use-frameworks"><a href="#use-frameworks" class="headerlink" title="use_frameworks!"></a>use_frameworks!</h1><p>ç¿»è¯‘è¿‡æ¥å°±æ˜¯:å¦‚æœä½ æƒ³ä½¿ç”¨swiftæˆ–è€…åŠ¨æ€åº“,å°±æŠŠä¸‹é¢ä¸€è¡Œæ³¨é‡Šæ‰“å¼€<br>ç„¶è€Œæ‰“å¼€åä½ æ˜¯ç¼–è¯‘ä¸è¿‡å»çš„,è¿™æ—¶éœ€è¦æ‰‹åŠ¨å¯¼å…¥swiftåº“<br><img src="http://upload-images.jianshu.io/upload_images/1715253-1910c75b87225c32.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä½¿ç”¨swiftæˆ–è€…åŠ¨æ€åº“ä½¿ç”¨use_frameworks"></p><p>ä¸‹é¢æ‰‹åŠ¨å¯¼å…¥Alamofireä½œä¸ºä¾‹å­:</p><p>##1)é¦–å…ˆä¸‹è½½Alamofireé¡¹ç›®æºç ,è§£å‹<br><img src="http://upload-images.jianshu.io/upload_images/1715253-cc75cc2e87dd1875.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Alamofireé¡¹ç›®æºç "><br>å¯ä»¥åˆ é™¤å¤šä½™çš„ä¸éœ€è¦çš„æ–‡ä»¶,æ¯”å¦‚Exampleæ–‡ä»¶å¤¹,ç­‰ç­‰</p><p>##2)å°†Alamofireé¡¹ç›®æ•´ä¸ªæ‹–åˆ°ä½ çš„é¡¹ç›®ä¸­<br><img src="http://upload-images.jianshu.io/upload_images/1715253-d0e942f8f731ffc6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ‹–åˆ°è‡ªå·±é¡¹ç›®ä¸­"></p><p>##3)åœ¨Embedded Binariesä¸­æ·»åŠ Alamofire.framework<br><img src="http://upload-images.jianshu.io/upload_images/1715253-8007cc13803cec7a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Embedded Binariesä¸­æ·»åŠ Alamofire.framework"></p><p>è¿™æ ·å°±å¯ä»¥cocoapodsç®¡ç†OCç¬¬ä¸‰æ–¹åº“,swiftç¬¬ä¸‰æ–¹åº“æ‰‹åŠ¨ç®¡ç†,å®ç°ä¸åŒç¬¬ä¸‰æ–¹æ¡†æ¶çš„è°ƒç”¨.</p>]]></content>
      
      
      <categories>
          
          <category> iOSå¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> Swift </tag>
            
            <tag> ç¬¬ä¸‰æ–¹æ¡†æ¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSæ€§èƒ½è°ƒä¼˜ä¹‹--tableViewä¼˜åŒ–</title>
      <link href="/2019/04/07/iOS%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E4%B9%8B-tableView%E4%BC%98%E5%8C%96/"/>
      <url>/2019/04/07/iOS%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E4%B9%8B-tableView%E4%BC%98%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä½œè€…åŸºäºä¹‹å‰è‡ªå·±æ‰€å†™çš„Swifté¡¹ç›®â€“ä»¿ç…§æ¨ç‰¹å®¢æˆ·ç«¯ç”¨çº¯Swiftå†™çš„ä¸€ä¸ªé¡¹ç›®,ç›®å‰å·²ç»å…¬å¼€æ”¾åœ¨GitHubä¸Š(<strong><em><a href="https://github.com/waitwalker/MyTwitter" target="_blank" rel="noopener">https://github.com/waitwalker/MyTwitter</a></em></strong>); æ¥å£ç”¨Pythonå†™çš„å‡ ä¸ª(<strong><em><a href="https://github.com/waitwalker/MyTwitterAPI" target="_blank" rel="noopener">https://github.com/waitwalker/MyTwitterAPI</a></em></strong>),ç›®å‰æ‰€å®ç°çš„åŠŸèƒ½æ˜¯ç™»å½•,æ³¨å†Œ,å‘æ¨,é¦–é¡µåˆ—è¡¨ç­‰åŠŸèƒ½,å…¶ä»–é¡µé¢éƒ½æ˜¯ä¸€äº›å‡æ•°æ®.è¿™é‡Œä¸ä¸»è¦åˆ†æé¡¹ç›®äº†,æœ‰æ—¶é—´åœ¨è¯¦ç»†è¯´ä¸€ä¸‹.æœ¬æ–‡çš„ä¸»è¦é‡ç‚¹æ˜¯è¯´è¯´è‡ªå·±å¯¹æ€§èƒ½è°ƒä¼˜â€“tableViewæ§ä»¶ä¼˜åŒ–çš„ä¸€ç‚¹ç†è§£,æœ‰äº›é—®é¢˜ç†è§£çš„ä¸æ˜¯å¾ˆé€å½»,å¸Œæœ›å¤§å®¶èƒ½å¤šç»™äº›æ„è§,å»ºè®®,è°¢è°¢.ä¸‹å›¾æ˜¯æ•´ä¸ªé¡¹ç›®çš„æ€»è§ˆ(æ–‡ç« ä¸­å¤šæ˜¯gifåŠ¨æ€,å°ºå¯¸è¾ƒå¤§,ä½¿ç”¨æµé‡çœ‹å¾—æ…é‡):<br><img src="https://upload-images.jianshu.io/upload_images/1715253-360caafd286f9f10.gif?imageMogr2/auto-orient/strip" alt="é¡¹ç›®æ€»è§ˆ1.gif"><br><img src="https://upload-images.jianshu.io/upload_images/1715253-35ff9103000752d7.GIF?imageMogr2/auto-orient/strip" alt="é¡¹ç›®æ€»è§ˆ2.GIF"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>æœ‰ä¸€å¥è¯è¯´:è¿‡æ—©çš„ä¼˜åŒ–æ˜¯ä¸‡æ¶ä¹‹æº, è¿‡æ—©å¹¶ä¸æ˜¯å¼€å‘è¿‡ç¨‹çš„æ—©æœŸï¼Œè€Œæ˜¯åœ¨è¿˜æ²¡å¼„æ¸…æ¥šä¸šåŠ¡éœ€æ±‚çš„æƒ…å½¢ä¸‹å»åšæ‰€è°“çš„ä¼˜åŒ–,æœ‰æ—¶å€™ä¼šé€‚å¾—å…¶åâ€”â€”è´¹æ—¶ã€è´¹åŠ›ã€ä¸è®¨å¥½ã€‚æ­£ç¡®çš„æ–¹æ³•æ˜¯ï¼Œå…ˆæœ‰è´¨é‡åœ°å®ç°ä½ çš„éœ€æ±‚ï¼Œå†™å¤Ÿæµ‹è¯•ç”¨ä¾‹ï¼Œç„¶ååšprofileå»æ‰¾åˆ°æ€§èƒ½çš„ç“¶é¢ˆï¼Œè€ƒè™‘ç©¶ç«Ÿå“ªäº›åœ°æ–¹åº”è¯¥ä¼˜åŒ–ï¼Œåº”è¯¥å¦‚ä½•ä¼˜åŒ–ï¼Œå“ªäº›ä¸åº”è¯¥ä¼˜åŒ–.</strong><br><img src="https://upload-images.jianshu.io/upload_images/1715253-0e7f39942a7a6c72.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ–‡ç« ç»“æ„.png"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä½œè€…å¯¹ä¸€äº›æ˜¾ç¤ºçš„å‚ç›´ä¿¡å·,æ°´å¹³ä¿¡å·åŸç†ä¸æ˜¯äº†è§£,å¤§å®¶å¦‚æœæƒ³æ·±å…¥äº†è§£çš„å¯ä»¥æŸ¥ä¸€ä¸‹ç›¸å…³èµ„æ–™,ç›¸å…³å¤§ç¥ä¹Ÿæœ‰æ€»ç»“,æˆ–è®¸ä»ç¡¬ä»¶åº•å±‚ä¼˜åŒ–å¯èƒ½æ•ˆæœä¼šæ›´å¥½.é€ æˆtableViewå¡é¡¿çš„åŸå› ,ä»ç¡¬ä»¶ä¸Šæ¥è¯´æ— éå°±ä¸¤ä¸ª,ä¸€ä¸ªæ˜¯CPUåŸå› ,ä¸€ä¸ªæ˜¯GPUåŸå› .å¦‚æœCPUæ ¸æ•°è¾ƒå¤š,å¹¶å‘å¤„ç†é—®é¢˜çš„èƒ½åŠ›ä¹Ÿå°±è¶Šå¼º,å¤„ç†å¤§é‡è®¡ç®—ä¹Ÿä¸åœ¨è¯ä¸‹;å¦‚æœGPUæ˜¾å­˜å¤Ÿå¤§,æ¸²æŸ“èƒ½åŠ›è¶³å¤Ÿå¼º,å¤„ç†å¤æ‚å›¾å½¢ç•Œé¢ä¹Ÿå°±å¾—å¿ƒåº”æ‰‹.ä½†æ˜¯,ç¡¬ä»¶çš„é…ç½®æ˜¯æœ‰é™åº¦çš„,æˆ‘ä»¬çš„ç›®æ ‡æ˜¯åœ¨æœ‰é™åº¦çš„ç¡¬ä»¶ä¸Š,è®©å…¶å‘æŒ¥æœ€å¤§é™åº¦çš„ä½œç”¨.è¿™ä¸ªä¹Ÿå°±æ˜¯é€ æˆtableViewå¡é¡¿çš„ç¨‹åºåŸå› (è½¯ä»¶åŸå› )â€“å¡ä½äº†ä¸»çº¿ç¨‹,æœ¬æ–‡å°†ä¸»è¦è®¨è®ºæ˜¯ä»ç¨‹åºè§’åº¦è®¨è®ºæ€ä¹ˆä¼˜åŒ–tableViewé—®é¢˜.</p><h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æœ€åŸºæœ¬çš„å°±æ˜¯å‡å°‘cellçš„è‡ªå®šä¹‰ç±»å‹,é‡ç”¨cell,æ¯æ¬¡åªç»˜åˆ¶å±å¹•æ˜¾ç¤ºcellçš„æ•°é‡,å…¶å®ƒcellä»ç¼“å­˜ä¸­å–.è¿™äº›åŸºç¡€å¤§å®¶åº”è¯¥æ¯”æˆ‘äº†è§£,è¿™é‡Œä¸å†é™ˆè¿°äº†.</p><h2 id="1-å‡è½»CPUè´Ÿè·"><a href="#1-å‡è½»CPUè´Ÿè·" class="headerlink" title="1. å‡è½»CPUè´Ÿè·"></a>1. å‡è½»CPUè´Ÿè·</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æˆ‘ä»¬çŸ¥é“CPUçš„ä¸»è¦è´Ÿè´£å¿«é€Ÿè°ƒåº¦ä»»åŠ¡,å¤§é‡è®¡ç®—å·¥ä½œ,æ‰€ä»¥åœ¨tableViewå¿«é€Ÿæ»šåŠ¨çš„è¿‡ç¨‹ä¸­è®©CPUçš„è®¡ç®—é‡é™ä½æ˜¯ä¼˜åŒ–åº”è¯¥è€ƒè™‘çš„æ–¹å‘.ä¸‹é¢æ€»ç»“äº†ä¸‰ä¸ªæ–¹é¢æ¥å°½å¯èƒ½çš„é™ä½CPUè®¡ç®—:</p><h3 id="1-1æå‰è®¡ç®—å¥½cellçš„é«˜åº¦-ç¼“å­˜åœ¨ç›¸åº”çš„æ•°æ®æºæ¨¡å‹ä¸­"><a href="#1-1æå‰è®¡ç®—å¥½cellçš„é«˜åº¦-ç¼“å­˜åœ¨ç›¸åº”çš„æ•°æ®æºæ¨¡å‹ä¸­" class="headerlink" title="1.1æå‰è®¡ç®—å¥½cellçš„é«˜åº¦,ç¼“å­˜åœ¨ç›¸åº”çš„æ•°æ®æºæ¨¡å‹ä¸­"></a>1.1æå‰è®¡ç®—å¥½cellçš„é«˜åº¦,ç¼“å­˜åœ¨ç›¸åº”çš„æ•°æ®æºæ¨¡å‹ä¸­</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¤§å®¶éƒ½å·²ç»çŸ¥é“tableViewçš„ä»£ç†å›è°ƒæ–¹æ³•ä¸­,å…ˆè°ƒç”¨çš„æ˜¯è¿”å›cellé«˜åº¦çš„æ–¹æ³•,ç„¶ååœ¨è¿”å›å®ä¾‹åŒ–cellçš„æ–¹æ³•.æˆ‘ä»¬å¯ä»¥åœ¨è¿”å›cellé«˜åº¦æ—¶,æå‰è®¡ç®—å¥½cellçš„é«˜åº¦,ç¼“å­˜åˆ°æ•°æ®æºæ¨¡å‹ä¸­.ä¾‹å¦‚:<em>MTTHomeModel</em>å¯¹åº”çš„æ˜¯é¦–é¡µcellçš„æ•°æ®æ¨¡å‹,æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸‹é¢ä¸¤ä¸ªå˜é‡,æ˜¯æ¥å­˜å‚¨cellçš„é«˜åº¦å’Œå†…å®¹é«˜åº¦çš„,:</p><pre><code>var cellHeight:CGFloat?var contentHeight:CGFloat?</code></pre><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åœ¨è·å–æ•°æ®åå°æ•°æ®çš„æ—¶å€™,æŠŠcellé«˜åº¦è®¡ç®—å‡ºæ¥,ç¼“å­˜èµ·æ¥:</p><pre><code>homeModel.contentHeight  = self.calculateTextHeight(text: homeModel.contentTextString!) + 150if(homeModel.retwitterType?.count)! &gt; Int(0){    homeModel.cellHeight = 255 + homeModel.contentHeight! - 150} else{    homeModel.cellHeight = 230 + homeModel.contentHeight! - 150 + 15}</code></pre><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åœ¨è¿”å›cellé«˜åº¦çš„æ–¹æ³•ä¸­,ç›´æ¥è¯»å–ç¼“å­˜çš„é«˜åº¦,è€Œä¸éœ€è¦åœ¨é‡æ–°è®¡ç®—äº†.</p><pre><code>func tableView(_ tableView: UITableView, heightForRowAt indexPath: IndexPath) -&gt; CGFloat    {        if self.homeDataArray != nil        {            let homeModel = homeDataArray![indexPath.row]            return homeModel.cellHeight!        } else        {            return 300        }    }</code></pre><h3 id="1-2-å°½å¯èƒ½çš„é™ä½storyboard-xibç­‰ä½¿ç”¨åº¦"><a href="#1-2-å°½å¯èƒ½çš„é™ä½storyboard-xibç­‰ä½¿ç”¨åº¦" class="headerlink" title="1.2 å°½å¯èƒ½çš„é™ä½storyboard,xibç­‰ä½¿ç”¨åº¦"></a>1.2 å°½å¯èƒ½çš„é™ä½storyboard,xibç­‰ä½¿ç”¨åº¦</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä¹‹å‰çœ‹åˆ°ä¸€äº›å¤§å®¶åˆ†äº«çš„ç›¸å…³èµ„æ–™,é€šè¿‡InterfaceçŸ¥é“xibæˆ–è€…storyboardæœ¬èº«å°±æ˜¯ä¸€ä¸ªxmlæ–‡ä»¶,æ·»åŠ åˆ é™¤æ§ä»¶å¿…ç„¶ä¸­é—´å¤šäº†ä¸€ä¸ªencode/decodeè¿‡ç¨‹,å¢åŠ äº†cpuçš„è®¡ç®—é‡.å¹¶ä¸” è¿˜è¦é¿å…è‡ƒè‚¿çš„ XIB æ–‡ä»¶,å› ä¸ºXIBæ–‡ä»¶åœ¨ä¸»çº¿ç¨‹ä¸­è¿›è¡ŒåŠ è½½å¸ƒå±€.å½“ç”¨åˆ°ä¸€äº›è‡ªå®šä¹‰Viewæˆ–è€…XIBæ–‡ä»¶æ—¶,XIBçš„åŠ è½½ä¼šæŠŠæ‰€æœ‰å†…å®¹åŠ è½½è¿›æ¥,å¦‚æœXIBé‡Œé¢çš„ä¸€äº›æ§ä»¶å¹¶ä¸ä¼šç”¨åˆ°,è¿™å°±å¯èƒ½é€ æˆä¸€äº›èµ„æºçš„æ¶ˆè€—æµªè´¹.ç½‘ä¸Šæœ‰è¯´:Storyboard æ²¡è¿™ä¸ªé—®é¢˜,åªä¼šæŒ‰éœ€åŠ è½½,è¿™ä¸ªä½œè€…è¿˜æ²¡æœ‰å»è€ƒè¯.</p><h3 id="1-3-æ»‘åŠ¨è¿‡ç¨‹ä¸­å°½é‡å‡å°‘é‡æ–°å¸ƒå±€"><a href="#1-3-æ»‘åŠ¨è¿‡ç¨‹ä¸­å°½é‡å‡å°‘é‡æ–°å¸ƒå±€" class="headerlink" title="1.3 æ»‘åŠ¨è¿‡ç¨‹ä¸­å°½é‡å‡å°‘é‡æ–°å¸ƒå±€"></a>1.3 æ»‘åŠ¨è¿‡ç¨‹ä¸­å°½é‡å‡å°‘é‡æ–°å¸ƒå±€</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;è‡ªåŠ¨å¸ƒå±€å°±æ˜¯ç»™æ§ä»¶æ·»åŠ çº¦æŸ,çº¦æŸæœ€ç»ˆè¿˜æ˜¯è½¬æ¢æˆframe.æ‰€ä»¥,åœ¨æ»¡è¶³ä¸šåŠ¡éœ€æ±‚æƒ…å†µä¸‹,å¦‚æœå›¾å±‚å±‚æ¬¡è¾ƒä¸ºå¤æ‚,è¦å°½é‡å‡å°‘è‡ªåŠ¨å¸ƒå±€çº¦æŸ,è½¬ä¸ºæ‰‹åŠ¨è®¡ç®—å¸ƒå±€,å¤§é‡çš„çº¦æŸé‡å ä¹Ÿä¼šå¢åŠ cpuçš„è®¡ç®—é‡<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä½œè€…åœ¨è·å–åˆ°æ•°æ®æºæ—¶,æ¯æ¬¡éƒ½é‡æ–°å¸ƒå±€æ§ä»¶,è¿™ä¸ªä¹Ÿæ˜¯ä¸€ä¸ªé‡è¦å¼€é”€,ä¹Ÿæ˜¯æ¥ä¸‹æ¥éœ€è¦ä¼˜åŒ–çš„æ–¹å‘.</p><pre><code>private funclayoutSubview(homeModel:MTTHomeModel) -&gt; Void{       topLineView?.snp.makeConstraints({ (make) in           make.left.right.top.equalTo(0)           make.height.equalTo(0.3)       })}</code></pre><h2 id="2-ä¸è¦é˜»å¡ä¸»çº¿ç¨‹"><a href="#2-ä¸è¦é˜»å¡ä¸»çº¿ç¨‹" class="headerlink" title="2. ä¸è¦é˜»å¡ä¸»çº¿ç¨‹"></a>2. ä¸è¦é˜»å¡ä¸»çº¿ç¨‹</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>UIKitçš„å·¥ä½œåŸºæœ¬ä¸Šéƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸Šè¿›è¡Œ,ç•Œé¢ç»˜åˆ¶,ç”¨æˆ·è¾“å…¥å“åº”ç­‰ç­‰.å½“æ‰€æœ‰çš„ä»£ç é€»è¾‘éƒ½æ”¾åœ¨ä¸»çº¿ç¨‹æ—¶,æŸäº›è€—æ—¶ä»»åŠ¡å¯èƒ½ä¼šå¡ä½ä¸»çº¿ç¨‹é€ æˆç¨‹åºæ— æ³•å“åº”,æµç•…åº¦é™ä½ç­‰é—®é¢˜;åœ¨ä¸»çº¿ç¨‹ä¸­ç»˜åˆ¶å¤§é‡ç•Œé¢å›¾å±‚,ç½‘ç»œI/O,ç£ç›˜I/Oç­‰éƒ½å¯ä»¥é€ æˆç•Œé¢å¡é¡¿ç°è±¡.</strong></p><p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡Xcodeè‡ªå¸¦çš„è°ƒè¯•å·¥å…·Instrumentsæ¥çœ‹çœ‹é¡¹ç›®ç•Œé¢çš„æµç•…åº¦,åŠå…¶ä¸€äº›å»ºè®®,Instrumentsç»™æˆ‘æä¾›äº†å„ç§å„æ ·çš„è°ƒè¯•æŸ¥çœ‹å·¥å…·,ä¸‹é¢ç®€å•ä»‹ç»ä¸€ä¸‹:<br><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1)Blank: åˆ›å»ºä¸€ä¸ªç©ºçš„æ¨¡æ¿,å¯ä»¥ä»Libraryåº“ä¸­æ·»åŠ å…¶ä»–æ¨¡æ¿.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2)Activity Monitor: ç›‘æ§è¿›ç¨‹çº§åˆ«çš„CPU,å†…å­˜,ç£ç›˜,ç½‘ç»œä½¿ç”¨æƒ…å†µ,å¯ä»¥å¾—åˆ°ä½ çš„åº”ç”¨ç¨‹åºåœ¨æ‰‹æœºè¿è¡Œæ—¶æ€»å…±å ç”¨çš„å†…å­˜å¤§å°.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3)Allocations: è·Ÿè¸ªè¿‡ç¨‹çš„åŒ¿åè™šæ‹Ÿå†…å­˜å’Œå †çš„å¯¹è±¡æä¾›ç±»åå’Œå¯é€‰ä¿ç•™/é‡Šæ”¾å†å²,å¯ä»¥æ£€æµ‹æ¯ä¸€ä¸ªå †å¯¹è±¡çš„åˆ†é…å†…å­˜æƒ…å†µ.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4)Cocoa Layout : è§‚å¯ŸNSLayoutConstraintå¯¹è±¡çš„æ”¹å˜,å¸®åŠ©æˆ‘ä»¬åˆ¤æ–­ä»€ä¹ˆæ—¶é—´ä»€ä¹ˆåœ°ç‚¹çš„constraintæ˜¯å¦åˆç†.è§‚å¯Ÿçº¦æŸå˜åŒ–,æ‰¾å‡ºå¸ƒå±€ä»£ç çš„é—®é¢˜æ‰€åœ¨.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5)Core Animation: è¿™ä¸ªæ¨¡å—æ˜¾ç¤ºç¨‹åºæ˜¾å¡æ€§èƒ½ä»¥åŠCPUä½¿ç”¨æƒ…å†µ,æŸ¥çœ‹ç•Œé¢æµç•…åº¦.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6)CoreData: è¿™ä¸ªæ¨¡å—è·Ÿè¸ªCore Dataæ–‡ä»¶ç³»ç»Ÿæ´»åŠ¨.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7)Counters : æ”¶é›†ä½¿ç”¨æ—¶é—´æˆ–åŸºäºäº‹ä»¶çš„æŠ½æ ·æ–¹æ³•çš„æ€§èƒ½ç›‘æ§è®¡æ•°å™¨(PMC)äº‹ä»¶.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8)Energy Log: è€—ç”µé‡ç›‘æ§.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;9)File Activity: æ£€æµ‹æ–‡ä»¶åˆ›å»º,ç§»åŠ¨,å˜åŒ–,åˆ é™¤ç­‰.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10)Leak: ä¸€èˆ¬çš„æªæ–½å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œæ£€æŸ¥æ³„æ¼çš„å†…å­˜ï¼Œå¹¶æä¾›äº†æ‰€æœ‰æ´»åŠ¨çš„åˆ†é…å’Œæ³„æ¼æ¨¡å—çš„ç±»å¯¹è±¡åˆ†é…ç»Ÿè®¡ä¿¡æ¯ä»¥åŠå†…å­˜åœ°å€å†å²è®°å½•.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;11)Metal System Trace: Metal APIæ˜¯apple 2014å¹´åœ¨ioså¹³å°ä¸Šæ¨å‡ºçš„é«˜æ•ˆåº•å±‚çš„3Då›¾å½¢API,å®ƒé€šè¿‡å‡å°‘é©±åŠ¨å±‚çš„APIè°ƒç”¨CPUçš„æ¶ˆè€—æé«˜æ¸²æŸ“æ•ˆç‡.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;12)Network: ç”¨é“¾æ¥å·¥å…·åˆ†æä½ çš„ç¨‹åºå¦‚ä½•ä½¿ç”¨TCP/IPå’ŒUDP/IPé“¾æ¥.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;13)SceneKit: 3Dæ€§èƒ½çŠ¶å†µåˆ†æ.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;14)System Trace: ç³»ç»Ÿè·Ÿè¸ª,é€šè¿‡æ˜¾ç¤ºå½“å‰è¢«è°ƒåº¦çº¿ç¨‹æä¾›ç»¼åˆçš„ç³»ç»Ÿè¡¨ç°,æ˜¾ç¤ºä»ç”¨æˆ·åˆ°ç³»ç»Ÿçš„è½¬æ¢ä»£ç é€šè¿‡ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨æˆ–å†…å­˜æ“ä½œ.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;15)System Usage: è¿™ä¸ªæ¨¡æ¿è®°å½•å…³äºæ–‡ä»¶è¯»å†™,sockets,I/Oç³»ç»Ÿæ´»åŠ¨,è¾“å…¥è¾“å‡º.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;16)Time Profiler(æ—¶é—´æ¢æŸ¥): æ‰§è¡Œå¯¹ç³»ç»Ÿçš„CPUä¸Šè¿è¡Œçš„è¿›ç¨‹ä½è´Ÿè½½æ—¶é—´ä¸ºåŸºç¡€é‡‡æ ·.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;17)Zombies: æµ‹é‡ä¸€èˆ¬çš„å†…å­˜ä½¿ç”¨,ä¸“æ³¨äºæ£€æµ‹è¿‡åº¦é‡Šæ”¾çš„é‡æŒ‡é’ˆå¯¹è±¡,ä¹Ÿæä¾›å¯¹è±¡åˆ†é…ç»Ÿè®¡ï¼Œä»¥åŠä¸»åŠ¨åˆ†é…çš„å†…å­˜åœ°å€å†å².</strong></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æœ¬æ–‡ä¸»è¦ä½¿ç”¨çš„æ˜¯Instrumentsä¸­çš„ç¬¬5ä¸ªå·¥å…·:Core Animation(å›¾å½¢æ€§èƒ½),è¿™ä¸ªæ¨¡å—æ˜¾ç¤ºç¨‹åºæ˜¾å¡æ€§èƒ½ä»¥åŠCPUä½¿ç”¨æƒ…å†µ,æŸ¥çœ‹ç•Œé¢æµç•…åº¦.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;é¦–å…ˆæˆ‘ä»¬å¿…é¡»è¦æŠŠæºç å®‰è£…åˆ°æµ‹è¯•è®¾å¤‡ä¸Š,1)è¿æ¥Xcodeè¿è¡Œç¨‹åº;2)ç„¶åé€‰æ‹©å¿«æ·é”®(Command + Control + i)è°ƒå‡ºInstruments,é€‰æ‹©Core Animation.æ‰“å¼€åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°Debug Optionsé‡Œé¢æœ‰å¤šä¸ªè°ƒè¯•é€‰é¡¹,ä¸‹é¢æˆ‘ä»¬æŒ¨ä¸ªå°½é‡æ¥åˆ†æçœ‹ä¸€ä¸‹:</p><p>###2.1 Color Blended Layers<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;è¿™ä¸ªé€‰é¡¹é€‰é¡¹åŸºäºæ¸²æŸ“ç¨‹åº¦å¯¹å±å¹•ä¸­çš„æ··åˆåŒºåŸŸè¿›è¡Œç»¿åˆ°çº¢çš„é«˜äº®æ˜¾ç¤º,è¶Šçº¢è¡¨ç¤ºæ€§èƒ½è¶Šå·®,ä¼šå¯¹å¸§ç‡ç­‰æŒ‡æ ‡é€ æˆè¾ƒå¤§çš„å½±å“.çº¢è‰²é€šå¸¸æ˜¯ç”±äºå¤šä¸ªåŠé€æ˜å›¾å±‚å åŠ å¼•èµ·.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä½œè€…é¡¹ç›®å¯èƒ½é¡¹ç›®æ¯”è¾ƒç®€å•,å›¾å±‚ä¹Ÿä¸æ˜¯å¾ˆå¤æ‚,æ‰€ä»¥é€šè¿‡Color Blended LayersæŸ¥çœ‹,æ·±çº¢è‰²å¹¶ä¸æ˜¯å¾ˆæ˜æ˜¾,åœ¨å¿«é€Ÿæ»‘åŠ¨çš„è¿‡ç¨‹ä¸­,å¸§ç‡ä¾ç„¶èƒ½å¤Ÿä¿æŒåœ¨55+ä»¥ä¸Š,å¹¶ä¸”å›¾å±‚ä¸­ä¹Ÿæ²¡æœ‰å¤§é‡çš„æ·±çº¢è‰²åŒºåŸŸå‡ºç°.<br><img src="https://upload-images.jianshu.io/upload_images/1715253-423fc34374dc56a4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ColorBlendedLayers1-1.png"><br><img src="https://upload-images.jianshu.io/upload_images/1715253-8641c471649c93a1.gif?imageMogr2/auto-orient/strip" alt="ColorBlendedLayers1-2-.gif"></p><p>###2.2 Color Hits Green and Misses Red<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å½“UIView.layer.shouldRasterize = YES æ—¶,è€—æ—¶çš„å›¾ç‰‡ç»˜åˆ¶ä¼šè¢«ç¼“å­˜,å¹¶å½“åšä¸€ä¸ªç®€å•çš„æ‰å¹³å›¾ç‰‡æ¥å‘ˆç°.è¿™æ—¶å€™,å¦‚æœé¡µé¢çš„å…¶ä»–åŒºå—(æ¯”å¦‚ UITableViewCell çš„å¤ç”¨)ä½¿ç”¨ç¼“å­˜ç›´æ¥å‘½ä¸­,å°±æ˜¾ç¤ºç»¿è‰²,åä¹‹,å¦‚æœä¸å‘½ä¸­,è¿™æ—¶å°±æ˜¾ç¤ºçº¢è‰².çº¢è‰²è¶Šå¤š,æ€§èƒ½è¶Šå·®.å› ä¸ºæ …æ ¼åŒ–ç”Ÿæˆç¼“å­˜çš„è¿‡ç¨‹æ˜¯æœ‰å¼€é”€çš„,å¦‚æœç¼“å­˜èƒ½è¢«å¤§é‡å‘½ä¸­å’Œæœ‰æ•ˆä½¿ç”¨,åˆ™æ€»ä½“ä¸Šä¼šé™ä½å¼€é”€,åä¹‹åˆ™æ„å‘³ç€è¦é¢‘ç¹ç”Ÿæˆæ–°çš„ç¼“å­˜,è¿™ä¼šè®©æ€§èƒ½é—®é¢˜é›ªä¸ŠåŠ éœœ.<br><img src="https://upload-images.jianshu.io/upload_images/1715253-f99e1282e6919417.gif?imageMogr2/auto-orient/strip" alt="ColorHitsGreenandMissesRed2-1.gif"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;è¿™é‡Œç¬”è€…è¿˜è¦æä¸€ä¸‹å›¾ç‰‡çš„åŠ è½½æ–¹å¼,æˆ‘ä»¬çŸ¥é“å›¾ç‰‡çš„ä¸€èˆ¬åŠ è½½æ–¹å¼æœ‰ä¸¤ç§:imageNamed å’ŒimageWithContentsOfFile;å®ƒä»¬çš„ä¸åŒåœ¨äºå‰è€…ä¼šå¯¹å›¾ç‰‡è¿›è¡Œç¼“å­˜,è€Œåè€…åªæ˜¯ç®€å•çš„ä»æ–‡ä»¶åŠ è½½æ–‡ä»¶.å¦‚æœä½ åŠ è½½çš„æ˜¯å¤§å›¾,å¹¶ä¸”åªä¼šç”¨åˆ°ä¸€æ¬¡,æ¯”å¦‚æ¬¢è¿å¼•å¯¼å›¾,é‚£ä¹ˆå°±æ²¡å¿…è¦ç¼“å­˜è¿™ä¸ªå›¾ç‰‡,å¯ä»¥ä½¿ç”¨[UIImage imageWithContentsOfFile:],ç”¨å®Œå°±é‡Šæ”¾äº†.å¦‚æœä¼šå¤šæ¬¡ä½¿ç”¨åˆ°ä¸€å¼ å›¾æ—¶,ç”¨[UIImage imageNamed:] å°±ä¼šé«˜æ•ˆå¾ˆå¤š,å› ä¸ºè¿™ç§åŠ è½½å›¾ç‰‡æ–¹å¼æœ‰ä¸€ä¸ªç¼“å­˜æœºåˆ¶.YYImageå®ç°åŸç†åº”è¯¥å°±æ˜¯åé¢è¿™ç§æ€è·¯,è‡ªå·±æ‰‹åŠ¨æ·»åŠ ç¼“å­˜.</p><p>###2.3 Color Copied Images<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¯¹äº GPU ä¸æ”¯æŒçš„è‰²å½©æ ¼å¼çš„å›¾ç‰‡åªèƒ½ç”± CPU æ¥å¤„ç†,æŠŠè¿™æ ·çš„å›¾ç‰‡æ ‡ä¸ºè“è‰².è“è‰²è¶Šå¤š,æ€§èƒ½è¶Šå·®.å› ä¸º,æˆ‘ä»¬ä¸å¸Œæœ›åœ¨æ»šåŠ¨è§†å›¾çš„æ—¶å€™,ç”± CPU æ¥å¤„ç†å›¾ç‰‡,è¿™æ ·å¯èƒ½ä¼šå¯¹ä¸»çº¿ç¨‹é€ æˆé˜»å¡.<br><img src="https://upload-images.jianshu.io/upload_images/1715253-e802ac2215033c3f.gif?imageMogr2/auto-orient/strip" alt="ColorCopiedImages3-1.gif"></p><p>###2.4 Color Immediately<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;é€šå¸¸ Core Animation Instruments ä»¥æ¯æ¯«ç§’ 10 æ¬¡çš„é¢‘ç‡æ›´æ–°å›¾å±‚è°ƒè¯•é¢œè‰²ã€‚å¯¹æŸäº›æ•ˆæœæ¥è¯´,è¿™æ˜¾ç„¶å¤ªæ…¢äº†.è¿™ä¸ªé€‰é¡¹å°±å¯ä»¥ç”¨æ¥è®¾ç½®æ¯å¸§éƒ½æ›´æ–°(å¯èƒ½ä¼šå½±å“åˆ°æ¸²æŸ“æ€§èƒ½,è€Œä¸”ä¼šå¯¼è‡´å¸§ç‡æµ‹é‡ä¸å‡†,æ‰€ä»¥ä¸è¦ä¸€ç›´éƒ½è®¾ç½®å®ƒ).<br><img src="https://upload-images.jianshu.io/upload_images/1715253-d53301f12380ce80.gif?imageMogr2/auto-orient/strip" alt="ColorImmediately4-1.gif"></p><p>###2.5 Color Misaligned Images<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;è¿™ä¸ªé€‰é¡¹æ£€æŸ¥äº†å›¾ç‰‡æ˜¯å¦è¢«ç¼©æ”¾,ä»¥åŠåƒç´ æ˜¯å¦å¯¹é½.è¢«æ”¾ç¼©çš„å›¾ç‰‡ä¼šè¢«æ ‡è®°ä¸ºé»„è‰²,åƒç´ ä¸å¯¹é½åˆ™ä¼šæ ‡æ³¨ä¸ºç´«è‰².é»„è‰²,ç´«è‰²è¶Šå¤š,æ€§èƒ½è¶Šå·®.<br><img src="https://upload-images.jianshu.io/upload_images/1715253-7785ce1122d31e88.gif?imageMogr2/auto-orient/strip" alt="ColorMisalignedImages5-1.gif"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;è¿™é‡ŒUIåœ¨åˆ‡å›¾çš„æ—¶å€™å°½é‡åˆ‡å¾—å°ºå¯¸å’Œä½ æ§ä»¶çš„å°ºå¯¸ä¿æŒä¸€è‡´,å°½é‡è®©å›¾ç‰‡ä¿æŒåŸå§‹å°ºå¯¸.ç¬”è€…è¿™é‡Œæ‰€ç”¨å›¾ç‰‡å‡ ä¹å…¨éƒ¨æ‹‰ä¼¸,ç”±äºå›¾ç‰‡éƒ½æ˜¯ä»æœ¬åœ°åŠ è½½çš„,æ²¡æœ‰ç»è¿‡å¤„ç†.</p><p>###2.6 Color Offscreen-Rendered Yellow<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;è¿™ä¸ªé€‰é¡¹ä¼šæŠŠé‚£äº›ç¦»å±æ¸²æŸ“çš„å›¾å±‚æ˜¾ç¤ºä¸ºé»„è‰².é»„è‰²è¶Šå¤š,æ€§èƒ½è¶Šå·®.è¿™äº›æ˜¾ç¤ºä¸ºé»„è‰²çš„å›¾å±‚å¾ˆå¯èƒ½éœ€è¦ç”¨ shadowPath æˆ–è€… shouldRasterize æ¥ä¼˜åŒ–.<br><img src="https://upload-images.jianshu.io/upload_images/1715253-cdcbfd43e7b5efa2.gif?imageMogr2/auto-orient/strip" alt="ColorOffscreen-RenderedYellow6-1.gif"></p><blockquote><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç¦»å±æ¸²æŸ“,å³ Off-Screen Rendering.ä¸ä¹‹ç›¸å¯¹çš„æ˜¯ On-Screen Rendering,å³åœ¨å½“å‰å±å¹•æ¸²æŸ“ï¼Œæ„æ€æ˜¯æ¸²æŸ“æ“ä½œæ˜¯ç”¨äºåœ¨å½“å‰å±å¹•æ˜¾ç¤ºçš„ç¼“å†²åŒºè¿›è¡Œ.é‚£ä¹ˆç¦»å±æ¸²æŸ“åˆ™æ˜¯æŒ‡å›¾å±‚åœ¨è¢«æ˜¾ç¤ºä¹‹å‰æ˜¯åœ¨å½“å‰å±å¹•ç¼“å†²åŒºä»¥å¤–å¼€è¾Ÿçš„ä¸€ä¸ªç¼“å†²åŒºè¿›è¡Œæ¸²æŸ“æ“ä½œ.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç¦»å±æ¸²æŸ“éœ€è¦å¤šæ¬¡åˆ‡&gt;æ¢ä¸Šä¸‹æ–‡ç¯å¢ƒ:å…ˆæ˜¯ä»å½“å‰å±å¹•(On-Screen)åˆ‡æ¢åˆ°ç¦»å±(Off-Screen);ç­‰åˆ°ç¦»å±æ¸²æŸ“ç»“æŸä»¥å,å°†ç¦»å±ç¼“å†²åŒºçš„æ¸²æŸ“ç»“æœæ˜¾ç¤ºåˆ°å±å¹•ä¸Šåˆéœ€è¦å°†ä¸Šä¸‹æ–‡ç¯å¢ƒä»ç¦»å±åˆ‡æ¢åˆ°å½“å‰å±å¹•,è€Œä¸Šä¸‹æ–‡ç¯å¢ƒçš„åˆ‡æ¢æ˜¯ä¸€é¡¹é«˜å¼€é”€çš„åŠ¨ä½œ.<br>ä¸€èˆ¬å¯¹æ§ä»¶å±æ€§æ“ä½œä¼šè§¦å‘ç¦»å±æ¸²æŸ“:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1)é˜´å½±(UIView.layer.shadowOffset/shadowRadius/â€¦)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2)åœ†è§’(å½“ UIView.layer.cornerRadius å’ŒUIView.layer.maskToBounds ä¸€èµ·ä½¿ç”¨æ—¶)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3)å›¾å±‚è’™æ¿<br>åœ¨å®é™…å¼€å‘ä¸­åº”å°½é‡é¿å…è§¦å‘ç¦»å±æ¸²æŸ“.</p></blockquote><p>###2.7 Color OpenGL Fast Path Blue<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;è¿™ä¸ªé€‰é¡¹ä¼šæŠŠä»»ä½•ç›´æ¥ä½¿ç”¨OpenGL ç»˜åˆ¶çš„å›¾å±‚æ˜¾ç¤ºä¸ºè“è‰².è“è‰²è¶Šå¤š,æ€§èƒ½è¶Šå¥½.å¦‚æœä»…ä»…ä½¿ç”¨ UIKit æˆ–è€… Core Animation çš„ API,é‚£ä¹ˆä¸ä¼šæœ‰ä»»ä½•æ•ˆæœ.å¦‚æœä½¿ç”¨ GLKView æˆ–è€… CAEAGLLayer,é‚£å¦‚æœä¸æ˜¾ç¤ºè“è‰²å—çš„è¯å°±æ„å‘³ç€ä½ æ­£åœ¨å¼ºåˆ¶ CPU æ¸²æŸ“é¢å¤–çš„çº¹ç†,è€Œä¸æ˜¯ç»˜åˆ¶åˆ°å±å¹•.</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>ä»»ä½•ä¼˜åŒ–éƒ½æ˜¯ä»¥ä¸šåŠ¡éœ€æ±‚ä¸ºå‰æ,åœ¨æ»¡è¶³åŸºæœ¬éœ€æ±‚çš„æƒ…å†µä¸‹,é€æ­¥æé«˜ä»£ç çš„è´¨é‡,æå‡ç¨‹åºæ€§èƒ½,ä¸ä»…æ˜¯è‡ªæˆ‘èƒ½åŠ›çš„è¡¨ç°,ä¹Ÿèƒ½ä»ä¸­è·å¾—ä¸€äº›æ”¶è·åŠæˆå°±æ„Ÿ.ä»¥ä¸Šä¼˜åŒ–æ–¹å‘æ€è·¯ä¹Ÿæ˜¯åœ¨å‰äººæ€»ç»“çš„åŸºç¡€ä¸Š,ä½œè€…åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­çš„ç®€å•åº”ç”¨,é‡Œé¢è¿˜æœ‰è®¸è®¸å¤šå¤šéœ€è¦æ”¹è¿›æå‡çš„åœ°æ–¹,ä¹Ÿå¸Œæœ›å¤§å®¶èƒ½ç»™ä¸€äº›æ·±å±‚æ¬¡ä¸Šçš„å»ºè®®æ„è§.</strong></p><h4 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h4><p><strong><em><a href="https://blog.ibireme.com/2015/11/12/smooth_user_interfaces_for_ios/" target="_blank" rel="noopener">https://blog.ibireme.com/2015/11/12/smooth_user_interfaces_for_ios/</a></em></strong></p>]]></content>
      
      
      <categories>
          
          <category> iOSå¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> ä¼˜åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSæ€§èƒ½è°ƒä¼˜ä¹‹--å†…å­˜ç®¡ç†</title>
      <link href="/2019/04/07/iOS%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E4%B9%8B-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/"/>
      <url>/2019/04/07/iOS%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E4%B9%8B-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iOSå†…å­˜ç®¡ç†æ— è®ºæ˜¯æ—©æœŸçš„MRCè¿˜æ˜¯ç°åœ¨çš„ARCæœ¬è´¨éƒ½æ˜¯é€šè¿‡å¼•ç”¨è®¡æ•°(Reference Counting)æœºåˆ¶ç®¡ç†å†…å­˜,å½“ä¸€ä¸ªå¯¹è±¡è¢«åˆ›å»ºå‡ºæ¥æ—¶,å®ƒçš„å¼•ç”¨è®¡æ•°ä»0åˆ°1,å½“æœ‰å¤–éƒ¨å¯¹è±¡å¯¹å®ƒè¿›è¡Œå¼ºå¼•ç”¨æ—¶,å®ƒçš„åº”ç”¨è®¡æ•°ä¼š+1,å½“è¯¥å¯¹è±¡æ”¶åˆ°ä¸€æ¡releaseæ¶ˆæ¯æ—¶,å®ƒçš„å¼•ç”¨è®¡æ•°ä¼š-1;å½“å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º0æ—¶,å¯¹è±¡å°†è¢«é‡Šæ”¾,å¯¹è±¡æŒ‡å‘çš„å†…å­˜è¢«å›æ”¶.</p><h2 id="1-ARCå†…å­˜ç®¡ç†çš„æœ¬è´¨"><a href="#1-ARCå†…å­˜ç®¡ç†çš„æœ¬è´¨" class="headerlink" title="1. ARCå†…å­˜ç®¡ç†çš„æœ¬è´¨"></a>1. ARCå†…å­˜ç®¡ç†çš„æœ¬è´¨</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>MRCæ—¶ä»£éœ€è¦ç¨‹åºå‘˜æ‰‹åŠ¨ç®¡ç†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ,ä¹Ÿå°±æ˜¯å¯¹è±¡çš„å¼•ç”¨è®¡æ•°æœ‰ç¨‹åºå‘˜æ¥æ§åˆ¶,ä»€ä¹ˆæ—¶å€™retain,ä»€ä¹ˆæ—¶å€™release,å®Œå…¨è‡ªå·±æŒæ¡.ARC(Automatic Reference Counting)è‡ªåŠ¨å¼•ç”¨è®¡æ•°æ˜¯ç¼–è¯‘å™¨çš„ä¸€ä¸ªç‰¹æ€§,èƒ½å¤Ÿè‡ªåŠ¨ç®¡ç†OCå¯¹è±¡å†…å­˜ç”Ÿå‘½å‘¨æœŸ.åœ¨ARCä¸­ä½ éœ€è¦ä¸“æ³¨äºå†™ä½ çš„ä»£ç , retain ,release, autoreleaseæ“ä½œäº¤ç»™ç¼–è¯‘å™¨å»å¤„ç†å°±è¡Œäº†.</strong><br><img src="https://upload-images.jianshu.io/upload_images/1715253-27c80639ff2b00b5.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="MRC_ARC_ç¤ºæ„å›¾_æ¥æº_Apple_Document.jpg"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ARC ä¸‹ç¼–è¯‘å™¨å¦‚ä½•è‡ªåŠ¨ç®¡ç†å†…å­˜,å…¶ä¸­,èƒ½æƒ³åˆ°çš„æ˜¯åœ¨ç±»çš„ dealloc æ–¹æ³•ä¸­ï¼Œå¯¹è¯¥ç±»çš„æ‰€æŒæœ‰çš„æˆå‘˜å˜é‡(strong)æ‰§è¡Œ release æ“ä½œ,è®©æ‰€æœ‰æˆå‘˜å˜é‡çš„å¼•ç”¨è®¡æ•°ä¸º0ã€‚å¯¹äºå±€éƒ¨å˜é‡,æ›´å¯èƒ½æ˜¯çš„å¯¹è±¡åœ¨å‡ºä½œç”¨åŸŸä¹‹å‰,ç¼–è¯‘å™¨è‡ªåŠ¨ç»™å¯¹è±¡åŠ ä¸Šä¸€æ¡ releaseæ¶ˆæ¯.è¿™äº›å·¥ä½œéƒ½æ˜¯ç¼–è¯‘å™¨ä¸ºæˆ‘ä»¬å¤„ç†äº†.</p><pre><code>// ä½œç”¨åŸŸ    {        NSString *str = [[NSString alloc]initWithFormat:@&quot;%@&quot;,@&quot;str&quot;];        NSLog(@&quot;%@&quot;,str);        // åœ¨å¯¹è±¡å‡ºä½œç”¨åŸŸæ—¶,ç¼–è¯‘å™¨è‡ªåŠ¨ç»™å¯¹è±¡å‘ä¸€æ¡releaseæ¶ˆæ¯        [str release];    }</code></pre><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ARC,åˆ™æ— éœ€æˆ‘ä»¬è‡ªå·±æ˜¾å¼æŒæœ‰(retain)å’Œé‡Šæ”¾(release)å¯¹è±¡,ARCé€šè¿‡å¯¹å¯¹åƒåŠ ä¸Šæ‰€æœ‰æƒä¿®é¥°ç¬¦(__strongç­‰),ç¼–è¯‘å™¨é€šè¿‡å¯¹è±¡çš„æ‰€æœ‰æƒä¿®é¥°ç¬¦å°†ä¼šè‡ªåŠ¨ç®¡ç†å¯¹è±¡çš„å¼•ç”¨è®¡æ•°.</p><h2 id="2-æ‰€æœ‰æƒä¿®é¥°ç¬¦"><a href="#2-æ‰€æœ‰æƒä¿®é¥°ç¬¦" class="headerlink" title="2. æ‰€æœ‰æƒä¿®é¥°ç¬¦"></a>2. æ‰€æœ‰æƒä¿®é¥°ç¬¦</h2><blockquote><p>åŸºç¡€çŸ¥è¯†:æŒ‡é’ˆæ˜¯å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡,å®ƒæŒ‡å‘ä¸€ä¸ªå†…å­˜åœ°å€å•å…ƒ,å†…å­˜å•å…ƒé‡Œå­˜ç€å„ç§å˜é‡.è¿™æ ·æŒ‡é’ˆå°±å¯ä»¥æŒ‡å‘è¿™æ ·å˜é‡,å½“æˆ‘ä»¬ç”¨çš„æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ä»å†…å­˜å•å…ƒå–å‡ºå˜é‡å†…å®¹.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Objective-Cå¯¹è±¡çš„ARCæ˜¯é€šè¿‡æ‰€æœ‰æƒä¿®é¥°ç¬¦æ¥ç®¡ç†å¯¹è±¡çš„æŒæœ‰å’Œé‡Šæ”¾ã€‚æ‰€æœ‰æƒä¿®é¥°ç¬¦ä¸€å…±æœ‰4ç§ï¼š</p></blockquote><h3 id="2-1-strong-ä¿®é¥°ç¬¦"><a href="#2-1-strong-ä¿®é¥°ç¬¦" class="headerlink" title="2.1 __strong ä¿®é¥°ç¬¦"></a>2.1 __strong ä¿®é¥°ç¬¦</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;é»˜è®¤çš„ä¿®é¥°ç¬¦,åªè¦æœ‰ä¸€ä¸ªå¼ºæŒ‡é’ˆæŒ‡å‘è¿™ä¸ªå¯¹è±¡,è¿™ä¸ªå¯¹è±¡å°±ä¸€ç›´ä¸ä¼šé”€æ¯,è¿™ä¸ªå¯¹è±¡æŒ‡å‘çš„æŒ‡é’ˆä¹Ÿä¸ä¼šç½®ä¸ºNULL.</p><pre><code>//è¿™é‡Œperson_one å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæŒ‡é’ˆ æŒ‡å‘ Personåˆ›å»ºçš„å‡ºæ¥çš„å¯¹è±¡(æŒ‡é’ˆ)çš„å†…å­˜,å¯ä»¥è¯»å–å†…å­˜ä¸Šçš„å†…å®¹    Person * __strong person_one = [[Person alloc]init];    Person * __strong person_two = person_one;    person_one = nil;    NSLog(@&quot;person_one:%@,person_oneåœ°å€:%p&quot;,person_one,person_one);    NSLog(@&quot;person_two:%@,person_twoåœ°å€:%p&quot;,person_two,person_two);Log:2018-03-19 16:19:09.822168 TestARC[16592:5864784] person_one:(null),person_oneåœ°å€:0x02018-03-19 16:19:22.443524 TestARC[16592:5864784] person_two:&lt;Person: 0x17001e450&gt;,person_twoåœ°å€:0x17001e450</code></pre><p><img src="https://upload-images.jianshu.io/upload_images/1715253-2902fc1e9aff3193.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="strongæ‰€æœ‰æƒä¿®é¥°.png"></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°,person_twoæ˜¯person_oneçš„æµ…æ‹·è´å¯¹è±¡,ä¹Ÿå°±æ˜¯æŒ‡é’ˆæ‹·è´å¯¹è±¡,è€Œperson_twoæ˜¯é€šè¿‡__strongä¿®é¥°,ç›¸å½“äºå¼ºæŒ‡é’ˆ,æŒ‡å‘çš„æ˜¯ä¸person_oneä¸€å—å†…å­˜åŒºåŸŸ.è€Œè¿™å—å†…å­˜åŒºåŸŸè¢«retainäº†ä¸¤æ¬¡,å¼•ç”¨è®¡æ•°ä¸º2,å³ä½¿person_one = nilå°†å¼•ç”¨è®¡æ•°-1äº†,person_twoä¾ç„¶å¯ä»¥æ‰“å°å‡ºå†…å­˜åœ°å€.person_oneçš„æŒ‡é’ˆå·²ç»è¢«ç½®ä¸ºNULL,æ‰€ä»¥æ‰“å°å‡ºçš„åœ°å€æ˜¯0x0.</p><h3 id="2-2-weak-ä¿®é¥°ç¬¦"><a href="#2-2-weak-ä¿®é¥°ç¬¦" class="headerlink" title="2.2 __weak ä¿®é¥°ç¬¦"></a>2.2 __weak ä¿®é¥°ç¬¦</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å½“æ²¡æœ‰å¼ºæŒ‡é’ˆæŒ‡å‘å¼±å¼•ç”¨çš„å¯¹è±¡æ—¶,å¼±å¼•ç”¨çš„å¯¹è±¡å°†è¢«ç½®ä¸ºnil,å¯¹è±¡çš„æŒ‡é’ˆç½®ä¸ºNULL.</p><pre><code>//è¿™é‡Œperson_one å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæŒ‡é’ˆ æŒ‡å‘ Personåˆ›å»ºçš„å‡ºæ¥çš„å¯¹è±¡(æŒ‡é’ˆ)çš„å†…å­˜,å¯ä»¥è¯»å–å†…å­˜ä¸Šçš„å†…å®¹    Person * __strong person_one = [[Person alloc]init];    Person * __weak person_two = person_one;    person_one = nil;    NSLog(@&quot;person_one:%@,person_oneåœ°å€:%p&quot;,person_one,person_one);    NSLog(@&quot;person_two:%@,person_twoåœ°å€:%p&quot;,person_two,person_two);Log:2018-03-19 16:28:21.453255 TestARC[16599:5866487] person_one:(null),person_oneåœ°å€:0x02018-03-19 16:28:25.521762 TestARC[16599:5866487] person_two:(null),person_twoåœ°å€:0x0</code></pre><p><img src="https://upload-images.jianshu.io/upload_images/1715253-062710f6ab6758cd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="weakæ‰€æœ‰æƒä¿®é¥°.png"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æˆ‘ä»¬çŸ¥é“__weakä¿®é¥°çš„å¯¹è±¡ä¸ä¼šå¯¹å¯¹è±¡è¿›è¡Œretain,æ‰€ä»¥person_twoæŒ‡å‘çš„å†…å­˜åŒºåŸŸå¯¹è±¡å¼•ç”¨è®¡æ•°è¿˜æ˜¯1.è¿™é‡Œåªæœ‰person_oneå¼ºå¼•ç”¨é‚£å—å†…å­˜åŒºåŸŸ,å½“person_one = nilæ—¶,å¼•ç”¨è®¡æ•°ä¸º0,å†…å­˜åŒºåŸŸè¢«é‡Šæ”¾,person_twoæŒ‡å‘çš„å†…å­˜åœ°å€ä¸º:0x0.</p><h3 id="2-3-unsafe-unretained-ä¿®é¥°ç¬¦"><a href="#2-3-unsafe-unretained-ä¿®é¥°ç¬¦" class="headerlink" title="2.3 __unsafe_unretained ä¿®é¥°ç¬¦"></a>2.3 __unsafe_unretained ä¿®é¥°ç¬¦</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å°±åƒå…¶è¡¨é¢æ„æ€ä¸€æ ·:å½“æ²¡æœ‰å¼ºæŒ‡é’ˆæŒ‡å‘__unsafe_unretainedä¿®é¥°çš„å¯¹è±¡æ—¶,è¿™ä¸ªå¯¹è±¡ä¼šè¢«ç½®ä¸ºnil,ä½†æ˜¯æŒ‡å‘å¯¹è±¡çš„æŒ‡é’ˆä¸ä¼šè¢«æ¸…ç©º,è‹¹æœå®˜æ–¹: the pointer is left dangling.</p><pre><code>//è¿™é‡Œperson_one å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæŒ‡é’ˆ æŒ‡å‘ Personåˆ›å»ºçš„å‡ºæ¥çš„å¯¹è±¡(æŒ‡é’ˆ)çš„å†…å­˜,å¯ä»¥è¯»å–å†…å­˜ä¸Šçš„å†…å®¹    Person * __strong person_one = [[Person alloc]init];    Person * __unsafe_unretained person_two = person_one;    person_one = nil;    NSLog(@&quot;person_one:%@,person_oneåœ°å€:%p&quot;,person_one,person_one);    NSLog(@&quot;person_two:%@,person_twoåœ°å€:%p&quot;,person_two,person_two);Log:2018-03-19 16:42:52.400375 TestARC[16608:5869804] person_one:(null),person_oneåœ°å€:0x0è¿™é‡Œå·²ç»æŠ¥é”™:Thread 1: EXC_BAD_ACCESS (code=1, address=0xb84d2beb8)</code></pre><p><img src="https://upload-images.jianshu.io/upload_images/1715253-5666a219c62ae22c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="unsafe__unretainedæ‰€æœ‰æƒä¿®é¥°.png"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;è¿™é‡Œæˆ‘ä»¬åœ¨ä¸»çº¿ç¨‹ä¸­æ”¶åˆ°ä¸€æ¡å´©æºƒä¿¡æ¯(EXC_BAD_ACCESS),é€šè¿‡<strong>unsafe_unretainedå®˜æ–¹æ–‡æ¡£è§£é‡Š,æˆ‘ä»¬å¯ä»¥çŒœå‡ºaddress=0xb84d2beb8åº”è¯¥æ˜¯person_oneæ²¡è¢«ç½®ä¸ºnilä¹‹å‰çš„å†…å­˜åœ°å€,è€Œå½“person_one = nilæ—¶,è¿™å—å†…å­˜å·²ç»è¢«å›æ”¶,è€Œperson_twoå› ä¸ºè¢«</strong>unsafe_unretainedä¿®é¥°,å…¶æŒ‡é’ˆè¿˜æ²¡æœ‰è¢«é”€æ¯,è¿˜æƒ³æŒ‡å‘è¿™å—å†…å­˜åœ°å€,æ‰€ä»¥é€ æˆäº†é‡æŒ‡é’ˆé”™è¯¯.</p><h3 id="2-4-autoreleasing-ä¿®é¥°ç¬¦"><a href="#2-4-autoreleasing-ä¿®é¥°ç¬¦" class="headerlink" title="2.4 __autoreleasing ä¿®é¥°ç¬¦"></a>2.4 __autoreleasing ä¿®é¥°ç¬¦</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;autorelease æœ¬è´¨ä¸Šå°±æ˜¯å»¶è¿Ÿè°ƒç”¨ release,è¿™é‡Œä¸åšç»†è‡´çš„åˆ†æäº†,å¤§å®¶æ„Ÿå…´è¶£çš„å¯ä»¥è‡ªå·±æ‰¾ç›¸å…³èµ„æ–™æŸ¥çœ‹.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åˆ°è¿™é‡Œæˆ‘ä»¬å¯¹ARCçš„å¼•ç”¨è®¡æ•°ç®¡ç†åº”è¯¥æœ‰äº†å¤§æ¦‚çš„äº†è§£.</p><h2 id="3-æºç åˆ†æ"><a href="#3-æºç åˆ†æ" class="headerlink" title="3. æºç åˆ†æ"></a>3. æºç åˆ†æ</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¼•ç”¨è®¡æ•°çš„å®ç°,æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹è‹¹æœçš„æºç (<a href="https://opensource.apple.com/source/objc4/).æˆ‘ä»¬ä¸‹é¢ä¸»è¦æ¥çœ‹çœ‹retainçš„å®ç°æºç ,æˆ‘ä»¬å¯ä»¥åœ¨OCçš„é¼»ç¥–ç±»--NSObjectä¸­å¯ä»¥çœ‹åˆ°åè®®NSObjectä¸­å®šä¹‰çš„å‡ ä¸ªæ–¹æ³•" target="_blank" rel="noopener">https://opensource.apple.com/source/objc4/).æˆ‘ä»¬ä¸‹é¢ä¸»è¦æ¥çœ‹çœ‹retainçš„å®ç°æºç ,æˆ‘ä»¬å¯ä»¥åœ¨OCçš„é¼»ç¥–ç±»--NSObjectä¸­å¯ä»¥çœ‹åˆ°åè®®NSObjectä¸­å®šä¹‰çš„å‡ ä¸ªæ–¹æ³•</a>:</p><pre><code>- (instancetype)retain OBJC_ARC_UNAVAILABLE;- (oneway void)release OBJC_ARC_UNAVAILABLE;- (instancetype)autorelease OBJC_ARC_UNAVAILABLE;- (NSUInteger)retainCount OBJC_ARC_UNAVAILABLE;</code></pre><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä»¥ä¸Šæ–¹æ³•,å°±æ˜¯ç¼–è¯‘å™¨åœ¨åˆé€‚çš„æ—¶æœºç»™å¯¹è±¡æ‰€è¦å‘é€çš„æ¶ˆæ¯.æˆ‘ä»¬ç‚¹è¿›å»retainæ–¹æ³•,æˆ‘ä»¬å¯ä»¥åœ¨NSObject.mmæ–‡ä»¶çš„2138è¡Œå¯ä»¥çœ‹åˆ°å…¶å®ç°:</p><pre><code>// Replaced by ObjectAlloc- (id)retain {    return ((id)self)-&gt;rootRetain();}</code></pre><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ²¿ç€è°ƒç”¨é“¾,æˆ‘ä»¬å¯ä»¥åœ¨objc-object.hæ–‡ä»¶ä¸­çœ‹åˆ°id rootRetain(bool tryRetain, bool handleOverflow)æ–¹æ³•çš„å®ç°:</p><pre><code>LWAYS_INLINE idobjc_object::rootRetain(bool tryRetain, bool handleOverflow){    assert(!UseGC);    if (isTaggedPointer()) return (id)this;    bool sideTableLocked = false;    bool transcribeToSideTable = false;    isa_t oldisa;    isa_t newisa;    do {        transcribeToSideTable = false;        oldisa = LoadExclusive(&amp;isa.bits);        newisa = oldisa;        if (!newisa.indexed) goto unindexed;        // don&#39;t check newisa.fast_rr; we already called any RR overrides        if (tryRetain &amp;&amp; newisa.deallocating) goto tryfail;        uintptr_t carry;        newisa.bits = addc(newisa.bits, RC_ONE, 0, &amp;carry);  // extra_rc++        if (carry) {            // newisa.extra_rc++ overflowed            if (!handleOverflow) return rootRetain_overflow(tryRetain);            // Leave half of the retain counts inline and            // prepare to copy the other half to the side table.            if (!tryRetain &amp;&amp; !sideTableLocked) sidetable_lock();            sideTableLocked = true;            transcribeToSideTable = true;            newisa.extra_rc = RC_HALF;            newisa.has_sidetable_rc = true;        }    } while (!StoreExclusive(&amp;isa.bits, oldisa.bits, newisa.bits));    if (transcribeToSideTable) {        // Copy the other half of the retain counts to the side table.        sidetable_addExtraRC_nolock(RC_HALF);    }    if (!tryRetain &amp;&amp; sideTableLocked) sidetable_unlock();    return (id)this; tryfail:    if (!tryRetain &amp;&amp; sideTableLocked) sidetable_unlock();    return nil; unindexed:    if (!tryRetain &amp;&amp; sideTableLocked) sidetable_unlock();    if (tryRetain) return sidetable_tryRetain() ? (id)this : nil;    else return sidetable_retain();}</code></pre><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æœ€åä¸€è¡Œsidetable_retain(),è¿™ä¸ªä¹Ÿæ˜¯retainæ–¹æ³•çš„æœ€ç»ˆè°ƒç”¨çš„æ–¹æ³•.è€Œsidetable_retain()çš„å®ç°:</p><pre><code>idobjc_object::sidetable_retain(){#if SUPPORT_NONPOINTER_ISA    assert(!isa.indexed);#endif    SideTable&amp; table = SideTables()[this];    if (table.trylock()) {        size_t&amp; refcntStorage = table.refcnts[this];        if (! (refcntStorage &amp; SIDE_TABLE_RC_PINNED)) {            refcntStorage += SIDE_TABLE_RC_ONE;        }        table.unlock();        return (id)this;    }    return sidetable_retain_slow(table);}</code></pre><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–¹æ³•ä¸­SideTableè¿™ä¸ªç»“æ„ä½“,</p><pre><code>struct SideTable {    spinlock_t slock;    RefcountMap refcnts;    weak_table_t weak_table;    SideTable() {        memset(&amp;weak_table, 0, sizeof(weak_table));    }    ~SideTable() {        _objc_fatal(&quot;Do not delete SideTable.&quot;);    }    void lock() { slock.lock(); }    void unlock() { slock.unlock(); }    bool trylock() { return slock.trylock(); }    // Address-ordered lock discipline for a pair of side tables.    template&lt;bool HaveOld, bool HaveNew&gt;    static void lockTwo(SideTable *lock1, SideTable *lock2);    template&lt;bool HaveOld, bool HaveNew&gt;    static void unlockTwo(SideTable *lock1, SideTable *lock2);};</code></pre><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å…¶ä¸­çš„ RefcountMap åº”è¯¥å°±æ˜¯å¼•ç”¨è®¡æ•°å“ˆå¸Œè¡¨ï¼Œè€Œweak_table_tåˆ™æ˜¯å¼±å¼•ç”¨è¡¨(weak table).<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RefcountMap åˆ™æ˜¯ä¸€ä¸ªç®€å•çš„ map,å…¶ key ä¸º object å†…å­˜åœ°å€ï¼Œvalue ä¸ºå¼•ç”¨è®¡æ•°å€¼.é€šè¿‡SideTableæºç ï¼Œè¿˜å¯ä»¥å¾—å‡ºå¦‚ä¸‹ç»“è®ºï¼š<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å­˜åœ¨å…¨å±€çš„è‹¥å¹²ä¸ªSideTableå®ä¾‹ï¼Œå®ƒä»¬ä¿å­˜åœ¨ static æˆå‘˜å˜é‡table_bufä¸­ï¼›<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ç”Ÿæˆçš„æ‰€æœ‰å¯¹è±¡éƒ½ä¼šé€šè¿‡å…¶å†…å­˜åœ°å€æ˜ å°„åˆ°table_bufä¸­ç›¸åº”çš„&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SideTableå®ä¾‹ä¸Š.è¿™é‡Œä¹‹æ‰€ä»¥ä¼šå­˜åœ¨å¤šä¸ªSideTableå®ä¾‹,object æ˜ å°„åˆ°ä¸åŒSideTableå®ä¾‹ä¸Š,çŒœæµ‹æ˜¯å‡ºäºæ€§èƒ½ä¼˜åŒ–çš„ç›®çš„ï¼Œé¿å…SideTableä¸­çš„ reference tableã€weak table è¿‡å¤§.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å›åˆ°ä¸Šé¢çš„sidetable_retainæ–¹æ³•ï¼Œå…¶é¦–å…ˆé€šè¿‡ object çš„åœ°å€æ‰¾åˆ°å¯¹åº”çš„ sidetaleï¼Œç„¶åé€šè¿‡ RefcountMapå°†è¯¥ object çš„å¼•ç”¨è®¡æ•°åŠ 1.ç®€å•åœ°è¯´ï¼ŒApple é€šè¿‡å…¨å±€çš„ map æ¥è®°å½•Reference Countingï¼Œå…¶key ä¸º object åœ°å€ï¼Œvalue ä¸ºå¼•ç”¨è®¡æ•°å€¼ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;releaseã€retainCountç­‰ç›¸å…³æ–¹æ³•çš„ä»£ç åœ¨è¯¥å¼€æºä»£ç ä¸­ä¹Ÿèƒ½æ‰¾åˆ°,è¿™é‡Œä¸ç»†è¯´äº†.</p><h2 id="4-ARCå¼€å‘ç¯å¢ƒéœ€è¦æ³¨æ„çš„ç®¡ç†å†…å­˜"><a href="#4-ARCå¼€å‘ç¯å¢ƒéœ€è¦æ³¨æ„çš„ç®¡ç†å†…å­˜" class="headerlink" title="4. ARCå¼€å‘ç¯å¢ƒéœ€è¦æ³¨æ„çš„ç®¡ç†å†…å­˜:"></a>4. ARCå¼€å‘ç¯å¢ƒéœ€è¦æ³¨æ„çš„ç®¡ç†å†…å­˜:</h2><h3 id="4-1CoreFoundation-Runtimeä»¥åŠå…¶ä»–Cè¯­è¨€åº“çš„ä½¿ç”¨"><a href="#4-1CoreFoundation-Runtimeä»¥åŠå…¶ä»–Cè¯­è¨€åº“çš„ä½¿ç”¨" class="headerlink" title="4.1CoreFoundation,Runtimeä»¥åŠå…¶ä»–Cè¯­è¨€åº“çš„ä½¿ç”¨"></a>4.1CoreFoundation,Runtimeä»¥åŠå…¶ä»–Cè¯­è¨€åº“çš„ä½¿ç”¨</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;é€šè¿‡malloc,create,copyç­‰åˆ›å»ºå¯¹è±¡,è¿˜éœ€è¦æ‰‹åŠ¨é‡Šæ”¾.</p><h3 id="4-2-å¾ªç¯å¼•ç”¨"><a href="#4-2-å¾ªç¯å¼•ç”¨" class="headerlink" title="4.2 å¾ªç¯å¼•ç”¨"></a>4.2 å¾ªç¯å¼•ç”¨</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¾ªç¯å¼•ç”¨æ˜¯ä¸¤ä¸ªæˆ–å¤šä¸ªå¯¹è±¡ä¹‹é—´ç›¸äº’æŒæœ‰,å½¢æˆç¯çŠ¶,å³ä½¿åœ¨æ²¡æœ‰å¤–éƒ¨å¯¹è±¡æŒ‡é’ˆæŒ‡å‘è¿™äº›å¯¹è±¡å†…å­˜åŒºåŸŸ(å †åŒº)çš„æ—¶å€™,ç³»ç»Ÿæ— æ³•å°†æ¯ä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°ç½®ä¸º0,ä»è€Œå¯¼è‡´è¿™äº›å¼€è¾Ÿå‡ºæ¥çš„å†…å­˜ä¸€ç›´å‘æŒ¥ç€â€å ç€èŒ…å‘ä¸æ‹‰å±â€çš„ä½œç”¨.è¿™éƒ¨åˆ†ä¸å®¹æ˜“æ£€æµ‹,ä¹Ÿå®¹æ˜“èƒŒé”….ä¸ç®¡æ–°è€å¸æœºé‡åˆ°é—®é¢˜ä¸å‡æ€ç´¢:å¾ªç¯å¼•ç”¨çš„é—®é¢˜(æ‰€ä»¥é‡åˆ°é—®é¢˜çš„æ—¶å€™,æˆ‘ä»¬æ›´å¤šçš„æ˜¯å¤šæ€è€ƒ,è€Œä¸æ˜¯åœ¨æ²¡æœ‰åˆ†æé—®é¢˜çš„æƒ…å†µä¸‹è„±å£è€Œå‡º,ä¸ä»…è¯¯å¯¼åˆ«äºº,è€Œä¸”æ˜¾å¾—è‡ªå·±å¾ˆæ°´,å¤šè¯´äº†ä¸¤å¥,è§ç¬‘).<br><img src="https://upload-images.jianshu.io/upload_images/1715253-674749fa15d20829.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¾ªç¯å¼•ç”¨ç¤ºæ„å›¾.png"></p><h2 id="5-å†…å­˜ç®¡ç†æ£€æµ‹"><a href="#5-å†…å­˜ç®¡ç†æ£€æµ‹" class="headerlink" title="5. å†…å­˜ç®¡ç†æ£€æµ‹"></a>5. å†…å­˜ç®¡ç†æ£€æµ‹</h2><h3 id="5-1-Analyzeé™æ€åˆ†æ"><a href="#5-1-Analyzeé™æ€åˆ†æ" class="headerlink" title="5.1 Analyzeé™æ€åˆ†æ"></a>5.1 Analyzeé™æ€åˆ†æ</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;é™æ€å†…å­˜åˆ†æ, æŒ‡çš„æ˜¯åœ¨ç¨‹åºæ²¡è¿è¡Œçš„æ—¶å€™, é€šè¿‡é¢„ç¼–è¯‘å¯¹ä»£ç è¿›è¡Œé¢„åˆ¤æ–­åˆ†æ,åˆ†æä»£ç çš„åŸºæœ¬æ•°æ®ç»“æ„,è¯­æ³•ç­‰,ç¼–è¯‘å™¨æ£€æŸ¥æ˜¯å¦å­˜åœ¨æ½œåœ¨çš„å†…å­˜æ³„éœ²åŠä¸è§„èŒƒçš„åœ°æ–¹.å¸¸é‡åˆ°é—®é¢˜:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1)The â€˜viewWillDisappear:â€™ instance method in UIViewController subclass â€˜xxxxxâ€™ is missing a [super viewWillDisappear:] call;è¿™ä¸ªé”™è¯¯æç¤ºæ˜¯:é‡å†™çˆ¶ç±»ä¸­çš„å®ä¾‹æ–¹æ³•viewWillDisappear,æ²¡æœ‰åœ¨å­ç±»ä¸­è°ƒç”¨,ä»ä¸‹å›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç¡®å®æ˜¯è¿™æ ·,-(void)viewWillDisappear:(BOOL)animatedæ–¹æ³•å†…éƒ¨è°ƒç”¨çš„æ˜¯[super viewDidAppear:animated];è¿™ç§æ˜¯å¾ˆä½çº§çš„é”™è¯¯.<br><img src="https://upload-images.jianshu.io/upload_images/1715253-85ff5e032f373642.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Analyze_1.png"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2)Value stored to â€˜xxxxxâ€™ is never read,å£°æ˜çš„å˜é‡æ²¡æœ‰è¢«ç”¨åˆ°<br><img src="https://upload-images.jianshu.io/upload_images/1715253-b74144bbc8d2352c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Analyze_2.png"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3) API Misuse æ¥å£åº”ç”¨é”™è¯¯,è¿™é‡Œä¸»è¦é’ˆå¯¹çš„æ˜¯ç³»ç»Ÿæä¾›çš„æ¥å£<br>ä»ä¸‹å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°,_cachedStatementsæ˜¯ä¸€ä¸ªå­—å…¸,å­—å…¸æ˜¯ä¸å…è®¸å‡ºç°nilå¯¹è±¡çš„,æ‰€ä»¥å­˜æ•°æ®ä¹‹å‰æˆ‘ä»¬è¦åšå®¹é”™åˆ¤æ–­.<br><img src="https://upload-images.jianshu.io/upload_images/1715253-29cf84141853dc67.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Analyze_3_1.png"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ”¹å®Œåå°±ä¸å†æç¤ºäº†<br><img src="https://upload-images.jianshu.io/upload_images/1715253-aa89d613c271f245.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Analyze_3_2.png"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4)Memory error,å†…å­˜é”™è¯¯:nil returned from a method that is expected to return a non-null value,æ–¹æ³•è¿”å›ä¸­éœ€è¦ä¸€ä¸ªå¯¹è±¡(æŒ‡é’ˆ),ä½ è¿”å›äº†ä¸€ä¸ªç©ºæŒ‡é’ˆ.ä¾‹å¦‚,ä¸‹å›¾åœ¨UITableViewçš„æ•°æ®æºå›è°ƒæ–¹æ³•è¿”å›cellçš„æ–¹æ³•ä¸­,æœ¬åº”è¿”å›ä¸€ä¸ªUITableViewCellå¯¹è±¡,å¯æ˜¯è¿™é‡Œè¿”å›äº†ä¸€ä¸ªnilå¯¹è±¡(ç©ºæŒ‡é’ˆ)<br><img src="https://upload-images.jianshu.io/upload_images/1715253-00e5d7fd34a88fa8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Analyze_4.png"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;è¿˜å­˜åœ¨å…¶ä»–æ½œåœ¨é—®é¢˜é”™è¯¯æˆ–è€…ä¸è§„èŒƒçš„åœ°æ–¹,å¤§å®¶å¯ä»¥ç…§ç€è¿™ä¸ªè‡ªå·±å»æŸ¥æ‰¾ä¸€ä¸‹è‡ªå·±çš„é¡¹ç›®.</p><h3 id="5-2-Instrumentså†…å­˜æ³„éœ²æ£€æµ‹"><a href="#5-2-Instrumentså†…å­˜æ³„éœ²æ£€æµ‹" class="headerlink" title="5.2 Instrumentså†…å­˜æ³„éœ²æ£€æµ‹"></a>5.2 Instrumentså†…å­˜æ³„éœ²æ£€æµ‹</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Instrumentså†…å­˜åˆ†æä½ åº”ç”¨å†…å­˜çš„ä½¿ç”¨æƒ…å†µ,å¸®åŠ©ä½ æŸ¥æ‰¾å®šä½å‡ºç°é—®é¢˜çš„ä»£ç åŒºåŸŸ.è¯¦ç»†ä»‹ç»å¯ä»¥å‚è€ƒapple developer documentation(<a href="https://developer.apple.com/library/content/documentation/DeveloperTools/Conceptual/InstrumentsUserGuide/CommonMemoryProblems.html#//apple_ref/doc/uid/TP40004652-CH91-SW1" target="_blank" rel="noopener">https://developer.apple.com/library/content/documentation/DeveloperTools/Conceptual/InstrumentsUserGuide/CommonMemoryProblems.html#//apple_ref/doc/uid/TP40004652-CH91-SW1</a>)<br>ä»æ–‡æ¡£ä¸­æˆ‘ä»¬å¤§æ¦‚å¯ä»¥çœ‹åˆ°,ä¸€ä¸ªåº”ç”¨æ‰€ä½¿ç”¨çš„å†…å­˜å¯èƒ½å ä¸‰ç§:</p><blockquote><p>Leaked memory: Memory unreferenced by your application that cannot be used again or freed (also detectable by using the Leaks instrument).<br>æ³„éœ²çš„å†…å­˜:åº”ç”¨æ— æ³•å†æ¬¡åº”ç”¨æˆ–è€…é‡Šæ”¾çš„å†…å­˜.<br>Abandoned memory: Memory still referenced by your application that has no useful purpose.<br>åºŸå¼ƒçš„å†…å­˜:ä½ çš„åº”ç”¨è¿˜å æ®ç€è¿™å—å†…å­˜,ä½†æ˜¯è¿™å—å†…å­˜æ— æ³•é‡Šæ”¾äº†,ARCä¸­æœ€æœ‰å¯èƒ½çš„æ˜¯å¾ªç¯å¼•ç”¨.<br>Cached memory: Memory still referenced by your application that might be used again for better performance.<br>ç¼“å­˜çš„å†…å­˜:èƒ½å¤Ÿè¢«ä½ çš„åº”ç”¨æ­£å¸¸é‡Šæ”¾å›æ”¶åˆ©ç”¨çš„å†…å­˜.<br>å†…å­˜æ³„éœ²ï¼šå¦‚æœç¨‹åºè¿è¡Œæ—¶ä¸€ç›´åˆ†é…å†…å­˜è€Œä¸åŠæ—¶é‡Šæ”¾æ— ç”¨çš„å†…å­˜ï¼Œç¨‹åºå ç”¨çš„å†…å­˜è¶Šæ¥è¶Šå¤§ï¼Œç›´åˆ°æŠŠç³»ç»Ÿåˆ†é…ç»™è¯¥APPçš„å†…å­˜æ¶ˆè€—æ®šå°½ï¼Œç¨‹åºå› æ— å†…å­˜å¯ç”¨å¯¼è‡´å´©æºƒï¼Œè¿™æ ·çš„æƒ…å†µæˆ‘ä»¬ç§°ä¹‹ä¸ºå†…å­˜æ³„æ¼ã€‚å¯èƒ½å¼•èµ·çš„é—®é¢˜:<br>1)å†…å­˜æ¶ˆè€—æ®†å°½çš„æ—¶å€™ï¼Œç¨‹åºä¼šå› æ²¡æœ‰å†…å­˜è¢«æ€æ­»ï¼Œå³crashã€‚<br>2)å½“å†…å­˜å¿«è¦ç”¨å®Œçš„æ—¶å€™ï¼Œä¼šéå¸¸çš„å¡é¡¿<br>3)å¦‚æœæ˜¯ViewControlleræ²¡æœ‰é‡Šæ”¾æ‰ï¼Œå¼•èµ·çš„å†…å­˜æ³„éœ²ï¼Œè¿˜ä¼šå¼•èµ·å…¶ä»–å¾ˆå¤šé—®é¢˜ï¼Œå°¤å…¶æ˜¯å’Œé€šçŸ¥ç›¸å…³çš„ã€‚æ²¡æœ‰è¢«é‡Šæ”¾æ‰çš„ViewControllerè¿˜èƒ½æ¥æ”¶é€šçŸ¥ï¼Œè¿˜ä¼šæ‰§è¡Œç›¸å…³çš„åŠ¨ä½œï¼Œæ‰€ä»¥ä¼šå¼•èµ·å„ç§å„æ ·çš„å¼‚å¸¸æƒ…å†µçš„å‘ç”Ÿã€‚</p></blockquote><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä»¥æˆ‘ä»¬ç°åœ¨å¼€å‘çš„é¡¹ç›®ä¸ºä¾‹:è¿™é‡Œæ‰“ä¸ªå¹¿å‘Š,æˆ‘ä»¬ç°åœ¨å¼€å‘çš„åº”ç”¨å«åšçˆ±å­¦.æ¨ªç‰ˆä¸»è¦æœ‰æˆ‘çš„ç­çº§,è‡ªå­¦,æ¶ˆæ¯,è®¾ç½®ç­‰æ¨¡å—,ä¸‹é¢æˆ‘ä»¬ç”¨Instrumentsæ¥æ£€æŸ¥ä¸€ä¸‹:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1)æ‰“å¼€è°ƒè¯•å·¥å…·æ­¥éª¤:é¦–å…ˆå…ˆå°†å¾…æ£€æµ‹çš„æºç å®‰è£…åˆ°ä½ çš„çœŸæœºè®¾å¤‡ä¸Š(Command + r æˆ–è€… ç›´æ¥Runè¿è¡Œ);ç„¶åæŒ‰ç€å¿«æ·é”®:Command + Control + i,æ‰“å¼€Instruments,é€‰æ‹©Leaks.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2)å®šä½å†…å­˜æ³„éœ²åŒºåŸŸ<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æˆ‘ä»¬é€‰æ‹©call_tree,ä¹Ÿå°±æ˜¯å‡½æ•°è°ƒç”¨æ ˆ,é¡ºè—¤æ‘¸ç“œ,æ‰¾åˆ°å†…å­˜æ³„éœ²çš„åœ°æ–¹<br><img src="https://upload-images.jianshu.io/upload_images/1715253-35a0756984c09923.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="call_tree.png"><br><img src="https://upload-images.jianshu.io/upload_images/1715253-8dd8d2a4259d6606.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="memory_leak.png"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä¸å‡ºæ„å¤–,å°±å¯ä»¥çœ‹åˆ°å…·ä½“å†…å­˜æ³„éœ²çš„ä»£ç äº†,æˆ‘ä»¬è¿™é‡Œæ˜¯ç”±äºä½¿ç”¨Runtimeäº†,è°ƒç”¨äº†class_copyPropertyListæ–¹æ³•.æˆ‘ä»¬çŸ¥é“Runtimeæ˜¯OCçš„åº•å±‚,æ˜¯OCçš„å¹•åå·¥ä½œè€…,æ‰€å†™çš„OCä»£ç æœ€ç»ˆéƒ½è½¬æ¢æˆRuntimeçš„Cä»£ç æ‰§è¡Œ.è¿™é‡Œé€šè¿‡class_copyPropertyListæ–¹æ³•æ¥è·å–ç±»çš„æ‰€æœ‰æˆå‘˜å˜é‡çš„æ—¶å€™,æ²¡æœ‰é‡Šæ”¾.æ‰€ä»¥åœ¨ä½¿ç”¨Cè¯­è¨€ç›¸å…³åº“çš„æ—¶å€™,ä¸€å®šè¦åšå¥½é‡Šæ”¾å·¥ä½œ(ä¸ç„¶è£…Bå°±è£…å¤§äº†ğŸ˜„,ç©ç¬‘).æœ€ç»ˆåœ¨ä½¿ç”¨éå†å®Œç±»ä¸­çš„æˆå‘˜å˜é‡å,free(properties);å°±æ²¡é—®é¢˜äº†.</p><pre><code>-(NSArray *)modelInfo:(Class)cls{    unsigned int  count = 0;    objc_property_t  * properties= class_copyPropertyList(cls, &amp;count);    NSMutableArray  * infoarr = [NSMutableArray new];    for (int i = 0; i&lt;count; i++)    {        objc_property_t property = properties[i];        NSString * name = [[NSString alloc]initWithCString:property_getName(property) encoding:NSUTF8StringEncoding ];        [infoarr addObject:name];    }    free(properties);    return infoarr;}</code></pre><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æˆ‘ä»¬çš„å­¦ä¹ ä»»åŠ¡ä¸­ä¸€ä¸ªè§†é¢‘ç±»å‹çš„ä»»åŠ¡,è§†é¢‘æ’­æ”¾å™¨ä¼°è®¡æ˜¯ä»ç½‘ä¸Šæ‰¾çš„åˆ«äººå°è£…å¥½çš„,æ²¡æœ‰ç»†è‡´åˆ†æå°±ç”¨äº†.ä»ä¸‹å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è‡³å°‘æœ‰ä¸‰ä¸ªç¯,æˆ‘ä»¬éœ€è¦æ‰“ç ´è¿™ç§ç¯çŠ¶,æ¶ˆé™¤å¼•ç”¨å¾ªç¯,è¿™é‡Œä¸ç»†è¯´,å¤§å®¶å¯ä»¥æ ¹æ®éœ€è¦å»è¯¦ç»†çœ‹çœ‹æ€ä¹ˆå¤„ç†å¼•ç”¨å¾ªç¯.<br><img src="https://upload-images.jianshu.io/upload_images/1715253-96a1e31299fb670a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="retain_recycle_1.png"><br><img src="https://upload-images.jianshu.io/upload_images/1715253-bb436103f2dc0783.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="retain_recycle_2.png"><br><img src="https://upload-images.jianshu.io/upload_images/1715253-15920f2bec2bed6e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="retain_recycle_3.png"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ–‡ä¸­ç®€å•ä»‹ç»äº†iOSå†…å­˜ç®¡ç†çš„ç›¸å…³å†…å®¹,ä¸»è¦çš„è¿˜æ˜¯ARCç›¸å…³å†…å®¹,è¿™äº›å¤§éƒ½æ˜¯åŸºäºå®é™…å¼€å‘ä¸­çš„æ€»ç»“å’Œå¹³æ—¶å­¦ä¹ çš„ç§¯ç´¯,é‡Œé¢ä¸ä¹ä¸€äº›é”™è¯¯å’Œä¸è§„èŒƒä¹‹å¤„,å¸Œæœ›æ²¡æœ‰æ²¡æœ‰å¤§å®¶æ²¡æœ‰è¢«è¯¯å¯¼,æ›´å¸Œæœ›å¤§å®¶å¤šç»™æ„è§å’Œå»ºè®®.å…¶å®,åŸºç¡€çŸ¥è¯†æ‰ç‰¢äº†,å¯¹ä¸€äº›é—®é¢˜çš„ç†è§£,è§£å†³å¯èƒ½ä¹Ÿä¼šæ›´åŠ æ¸¸åˆƒæœ‰ä½™,è€Œä¸æ˜¯å¤©å¤©çº ç»“äºä¸€äº›â€ç•Œé¢â€ä¸Šçš„é—®é¢˜.</p><h4 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h4><p><a href="https://blog.devtang.com/2016/07/30/ios-memory-management/" target="_blank" rel="noopener">https://blog.devtang.com/2016/07/30/ios-memory-management/</a><br><a href="https://developer.apple.com/library/content/documentation/DeveloperTools/Conceptual/InstrumentsUserGuide/FindingLeakedMemory.html" target="_blank" rel="noopener">https://developer.apple.com/library/content/documentation/DeveloperTools/Conceptual/InstrumentsUserGuide/FindingLeakedMemory.html</a><br><a href="http://clang.llvm.org/docs/AutomaticReferenceCounting.html" target="_blank" rel="noopener">http://clang.llvm.org/docs/AutomaticReferenceCounting.html</a></p>]]></content>
      
      
      <categories>
          
          <category> iOSå¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> å†…å­˜ç®¡ç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSæŒç»­é›†æˆæ„å»º</title>
      <link href="/2019/04/07/iOS%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E6%9E%84%E5%BB%BA/"/>
      <url>/2019/04/07/iOS%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E6%9E%84%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç›®å‰å¸‚é¢ä¸ŠæŒç»­é›†æˆçš„æ–¹æ¡ˆå¾ˆå¤š:ä¾‹å¦‚,<strong>Jenkins, Fastlane,Xcode server</strong>ç­‰,è¿™äº›æŒç»­é›†æˆçš„æ–¹æ¡ˆå¤§åŒå°å¼‚,ä»–ä»¬ä¹‹é—´çš„æ€§èƒ½å·®å¼‚ç¬”è€…æ²¡æœ‰åšå¤§é‡çš„æ¨ªå‘åˆ†æ,åªæ˜¯å¤§ä½“æ¯”è¾ƒäº†ä¸€ä¸‹æ‰“åŒ…æ—¶é—´.æ€»ç»“æ¥è¯´,æŒç»­é›†æˆä¸»è¦æ˜¯ä¸‰ä¸ªæ­¥éª¤:1.æ‹‰å–ä»£ç ;2.ç¼–è¯‘æ‰“åŒ…;3.åˆ†å‘æ•°æ®(æ‰“åŒ…ç»“æœ),ä¸‹é¢å°†é€šè¿‡ä¸¤ç§æ–¹æ¡ˆ(Jenkinså’ŒXcode server)æ¥åˆ†æä¸€ä¸‹è¿™ä¸‰ä¸ªè¿‡ç¨‹.</p><h1 id="Jenkinsé›†æˆæ–¹æ¡ˆ"><a href="#Jenkinsé›†æˆæ–¹æ¡ˆ" class="headerlink" title="Jenkinsé›†æˆæ–¹æ¡ˆ"></a>Jenkinsé›†æˆæ–¹æ¡ˆ</h1><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jenkinsä½œä¸ºå…è´¹é›†æˆæ–¹æ¡ˆ,å…¶ç¤¾åŒºæ‹¥æœ‰å¤§é‡æ’ä»¶,éå¸¸å‹å¥½,æ‰€ä»¥ç”¨æˆ·ä¹Ÿä¼—å¤š.<br>é¦–å…ˆæ¥å®‰è£…Jenkins,Jenkinså®˜ç½‘æä¾›äº†å¤šä¸ªç³»ç»Ÿç¯å¢ƒçš„è½¯ä»¶åŒ…,æˆ‘é€‰æ‹©çš„æ˜¯macOsç³»ç»Ÿ,é€‰æ‹©ä¸‹è½½å®‰è£…,æ­¥éª¤å¦‚ä¸‹å›¾:</p><h3 id="ä¸‹è½½Jenkins"><a href="#ä¸‹è½½Jenkins" class="headerlink" title="ä¸‹è½½Jenkins"></a>ä¸‹è½½Jenkins</h3><p><img src="http://upload-images.jianshu.io/upload_images/1715253-74793443eb9d2e37.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¸‹è½½Jenkins.png"></p><h3 id="å®‰è£…Jenkins"><a href="#å®‰è£…Jenkins" class="headerlink" title="å®‰è£…Jenkins"></a>å®‰è£…Jenkins</h3><p><img src="http://upload-images.jianshu.io/upload_images/1715253-3767d8e62b58ab6d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å®‰è£…Jenkins.png"></p><h3 id="è®¾ç½®ç®¡ç†å‘˜è´¦å·å¯†ç "><a href="#è®¾ç½®ç®¡ç†å‘˜è´¦å·å¯†ç " class="headerlink" title="è®¾ç½®ç®¡ç†å‘˜è´¦å·å¯†ç "></a>è®¾ç½®ç®¡ç†å‘˜è´¦å·å¯†ç </h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å®‰è£…å®Œæˆå,ä¸€èˆ¬macç¯å¢ƒé›†æˆäº†ApacheæœåŠ¡å™¨ä¼šè‡ªåŠ¨é…ç½®å¯åŠ¨8080ç«¯å£,Jenkinsçš„åˆå§‹åŒ–é¡µé¢ä¹Ÿä¼šåœ¨å®‰è£…å®Œæˆåè‡ªåŠ¨å¼¹å‡º.æ­¤æ—¶åªè¦æ‰¾åˆ°å›¾ä¸­çº¢è‰²æ ‡è®°è·¯å¾„catæˆ–è€…viçœ‹ä¸€ä¸‹é‡Œé¢çš„ç§˜é’¥,è¿›å…¥Jenkinsåˆå§‹åŒ–è®¾ç½®å·¥ä½œ.è¿™ä¸ªè¿‡ç¨‹ä¼šè®¾ç½®ç®¡ç†å‘˜è´¦å·å¯†ç ç­‰.<br><img src="http://upload-images.jianshu.io/upload_images/1715253-d1d90f913140c3ff.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è·å–åˆå§‹å¯†ç Jenkins.png"></p><h3 id="Jenkinsæ’ä»¶å®‰è£…"><a href="#Jenkinsæ’ä»¶å®‰è£…" class="headerlink" title="Jenkinsæ’ä»¶å®‰è£…"></a>Jenkinsæ’ä»¶å®‰è£…</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åˆå§‹åŒ–å®Œæˆå,å°±å¯ä»¥åˆ©ç”¨ç®¡ç†å‘˜è´¦å·ç™»å½•.ç™»å½•åé€šå¸¸å¯ä»¥å®‰è£…ä¸€äº›å¸¸ç”¨æ’ä»¶,ä¸€èˆ¬æœ‰é»˜è®¤æ’ä»¶å’Œè‡ªå®šä¹‰æ’ä»¶,é€‰æ‹©é»˜è®¤æ’ä»¶å³å¯.<br><img src="http://upload-images.jianshu.io/upload_images/1715253-4568ef21195c5c02.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Jenkinså®‰è£…æ’ä»¶.png"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åŸºæœ¬çš„ç¯å¢ƒæ­å»ºå®Œæˆå,å°±å¯ä»¥å®æ–½ä¸Šé¢çš„ä¸‰ä¸ªè¿‡ç¨‹äº†.å…¶å®Jenkinsçš„ä¸»è¦å·¥ä½œæµç¨‹,å¯ä»¥é€šè¿‡ä¸‹å›¾æ¥ç›´è§‚çœ‹å‡ºæ¥.<br><img src="http://upload-images.jianshu.io/upload_images/1715253-355b1d4d4cfc90bd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Jenkinså·¥ä½œæµç¨‹.png"></p><h2 id="æ­¥éª¤1-æ‹‰å–ä»£ç "><a href="#æ­¥éª¤1-æ‹‰å–ä»£ç " class="headerlink" title="æ­¥éª¤1 æ‹‰å–ä»£ç "></a>æ­¥éª¤1 æ‹‰å–ä»£ç </h2><p><img src="http://upload-images.jianshu.io/upload_images/1715253-fadcbca7317ace47.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="gitä»“åº“åˆ†æ”¯é…ç½®.png"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ‹‰å–ä»£ç è¿‡ç¨‹æ¯”è¾ƒç®€å•,ä¸»è¦æ˜¯ä»æŒ‡å®šä»“åº“ä¸­å…‹éš†ä»£ç åˆ°Jenkinsçš„å·¥ä½œç›®å½•.</p><h2 id="æ­¥éª¤2-ç¼–è¯‘æ‰“åŒ…"><a href="#æ­¥éª¤2-ç¼–è¯‘æ‰“åŒ…" class="headerlink" title="æ­¥éª¤2 ç¼–è¯‘æ‰“åŒ…"></a>æ­¥éª¤2 ç¼–è¯‘æ‰“åŒ…</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç¼–è¯‘æ‰“åŒ…å‘½ä»¤ä¸»è¦æœ‰xcodebuild,xcrun,xctool(facebook)ç­‰,å‰ä¸¤ä¸ªæ˜¯å®˜æ–¹çš„,åä¸€ä¸ªæ˜¯Facebookå‡ºå“,xctoolé‡Œé¢é›†æˆäº†ä¸ªæ€§åŒ–å®šåˆ¶,éœ€è¦çš„å¯ä»¥ç»†ç ”ç©¶ä¸€ä¸‹,æ–‡ä¸­åªæ˜¯å¯¹xcodebuildåšå‡ºä½¿ç”¨åˆ†æ.<br>xcodebuildç¼–è¯‘è¿‡ç¨‹ä¹Ÿä¸»è¦åˆ†ä¸‰ä¸ªè¿‡ç¨‹:</p><pre><code>- clean    xcodebuild -workspace MyWorkspace.xcworkspace -scheme SchemeName- archive     xcodebuild archive -workspace MyWorkspace.xcworkspace -scheme SchemeName- export ipa     xcodebuild -exportArchive -archivePath MyMobileApp.xcarchive -exportPath ExportDestination.ipa -exportOptionsPlist &#39;exportPlist.plist&#39;</code></pre><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>è¿™é‡Œå¤šè¯´ä¸¤å¥:ç”±äºIDEå˜åŒ–,å¯¼è‡´ç¼–è¾‘è„šæœ¬ç¨å¾®æœ‰ä¸€äº›å‡ºå…¥,ä¸»è¦æ˜¯åœ¨ç¼–è¯‘çš„ç¬¬ä¸‰æ­¥(- export ipa),è¿™æ­¥Xcode 8.0éœ€è¦æŒ‡å®šæè¿°æ–‡ä»¶,Xcode 9.0éœ€è¦æŒ‡å®šexportOptionsPlist(è¿™ä¸ªæ˜¯ä¸»è¦åŒ…å«ä¸€äº›è¯ä¹¦, ipaæ¨¡å¼ç­‰é”®å€¼è¡¨).ä¸‹é¢è´´å‡ºæ‰“åŒ…æ‰§è¡Œè„šæœ¬çš„å…¨éƒ¨å‘½ä»¤(Xcode 9.0):</strong></p><pre><code>export ETT_APP_NAME=appåç§°export ETT_WORKSPACE_NAME=å·¥ä½œåŒºåç§°export ETT_SCHEME=schemeåç§°export ETT_PROVISIONING_PROFILE=æè¿°æ–‡ä»¶(Xcode9.0ç”¨ä¸åˆ°)export ETT_BUILD_TYPE=ç¼–è¯‘ç±»å‹(ç”¨äºåŒºåˆ†å‘å¸ƒè¿˜æ˜¯AdHocæ¨¡å¼,å¯ä»¥å¿½ç•¥)export ETT_CONFIGURATION=ç¼–è¯‘é…ç½®(ä¸»è¦æ ¹æ®è‡ªå·±çš„å¤šç¯å¢ƒè¿›è¡Œé…ç½®,æ¯”å¦‚Release,Debugç­‰)###############################################################################################################export ETT_JENKINS_TIME=$(date +%m%d)export ETT_GIT_COMMIT=${GIT_COMMIT:0:7}export ETT_GIT_REV=`git rev-list HEAD | wc -l | awk &#39;{print $1}&#39;`export ETT_VERSION_PRO=`/usr/bin/agvtool mvers -terse1`export ETT_VERSION_NUMBER=$ETT_VERSION_PRO$ETT_BUILD_TYPEexport ETT_BUILD_VERSION=$ETT_GIT_REV.$BUILD_NUMBERexport ETT_BUILD_ID=$ETT_VERSION_NUMBER-$ETT_JENKINS_TIME-$ETT_GIT_REV-$BUILD_NUMBER-G$ETT_GIT_COMMITexport NEXUS_JENKINS_NAME=æ‰“åŒ…åä¸Šä¼ è´¦å·export NEXUS_JENKINS_PASSWD=å¯†ç export ExportOptionsPlistPath=/Users/ç”¨æˆ·/Downloads/zhengshu/ExportOptions.plistexport XCODE=/usr/binexport ETT_DIST_ROOT_PATH=å·¥ä½œåŒºè·¯å¾„export ETT_DIST_PATH=$ETT_DIST_ROOT_PATH/$BUILD_NUMBERexport ETT_ARCHIVE_PATH=$ETT_DIST_PATH/$ETT_APP_NAME.xcarchiveexport ETT_WORK_SPACE=$WORKSPACE/$ETT_WORKSPACE_NAME.xcworkspaceexport ETT_FILE_NAME=$ETT_APP_NAME-$ETT_BUILD_IDexport ETT_IPA_NAME=$ETT_FILE_NAME.ipaexport ETT_EXPORT_PATH=$ETT_DIST_PATH/$ETT_IPA_NAMEexport ETT_PACKAGE_NAME=$ETT_FILE_NAME.tar.gzexport ETT_PACKAGE_PATH=$ETT_DIST_PATH/$ETT_PACKAGE_NAMEexport ETT_NEXUS_FILE_NAME=$ETT_APP_NAME-$ETT_JENKINS_TIME-$BUILD_NUMBER-$ETT_GIT_COMMIT.tar.gzexport ETT_UPLOAD_DSYM_SRC=$ETT_WORKSPACE_NAME.app.dSYMexport ETT_UPLOAD_DSYM_FILE=$ETT_FILE_NAME-dSYM.zipexport ETT_UPLOAD_DSYM_PATH=$ETT_DIST_PATH/$ETT_UPLOAD_DSYM_FILEif [ ! -d &quot;$ETT_DIST_ROOT_PATH&quot; ]; then  mkdir $ETT_DIST_ROOT_PATHfiif [ ! -d &quot;$ETT_DIST_PATH&quot; ]; then  mkdir $ETT_DIST_PATHfi#/usr/bin/agvtool vers -terse#/usr/bin/agvtool mvers -terse1/usr/bin/agvtool new-marketing-version $ETT_VERSION_PRO/usr/bin/agvtool new-version -all $ETT_VERSION_PRO.$ETT_BUILD_VERSION#/usr/bin/agvtool vers -terse#/usr/bin/agvtool mvers -terse1$XCODE/xcodebuild clean build BITCODE_GENERATION_MODE=bitcode OTHER_CFLAGS=&quot;-fembed-bitcode&quot; archive -archivePath &quot;$ETT_ARCHIVE_PATH&quot; -workspace $ETT_WORK_SPACE -destination generic/platform=iOS -scheme $ETT_SCHEME -configuration &quot;$ETT_CONFIGURATION&quot; BUILD_NUMBER=&quot;$ETT_BUILD_ID&quot; CONFIGURATION_BUILD_DIR=$ETT_DIST_PATH UPLOAD_dSYM_FILE=$ETT_UPLOAD_DSYM_FILE$XCODE/xcodebuild -exportArchive -archivePath $ETT_ARCHIVE_PATH -exportPath $ETT_EXPORT_PATH -exportOptionsPlist $ExportOptionsPlistPath -allowProvisioningUpdates</code></pre><h2 id="æ­¥éª¤3-åˆ†å‘æ•°æ®-å‘å¸ƒæ‰“åŒ…"><a href="#æ­¥éª¤3-åˆ†å‘æ•°æ®-å‘å¸ƒæ‰“åŒ…" class="headerlink" title="æ­¥éª¤3 åˆ†å‘æ•°æ®(å‘å¸ƒæ‰“åŒ…)"></a>æ­¥éª¤3 åˆ†å‘æ•°æ®(å‘å¸ƒæ‰“åŒ…)</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;è¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç›´æ¥å‘å¸ƒ,ä¹Ÿå¯ä»¥ä¸Šä¼ åˆ°è‡ªå·±æŒ‡å®šçš„æœåŠ¡å™¨,ç¬¬ä¸‰æ–¹æ‰˜ç®¡æœåŠ¡å™¨ç­‰.æˆ‘ä»¬ç›´æ¥åœ¨æ‰§è¡Œæ‰“åŒ…è„šæœ¬çš„æœ€åé¢,å°†æ‰“åŒ…å¤„ç†çš„ipaæ–‡ä»¶ä»¥åŠç¬¦å·åŒ–æ–‡ä»¶æ‰“åŒ…åç›´æ¥ä¸Šä¼ åˆ°æŒ‡å®šæœåŠ¡å™¨:</p><pre><code>cd $ETT_DIST_PATHzip -r $ETT_UPLOAD_DSYM_PATH $ETT_UPLOAD_DSYM_SRCtar -C $ETT_DIST_PATH -zcvf  $ETT_PACKAGE_PATH $ETT_IPA_NAME $ETT_UPLOAD_DSYM_FILEcurl -v -u $NEXUS_JENKINS_NAME:$NEXUS_JENKINS_PASSWD --upload-file $ETT_PACKAGE_PATH  æœåŠ¡å™¨è·¯å¾„$ETT_APP_NAME/ios/$ETT_VERSION_PRO$ETT_BUILD_TYPE/$ETT_NEXUS_FILE_NAME</code></pre><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>åˆ°è¿™é‡Œ,Jenkinsçš„ç®€å•é›†æˆè¿‡ç¨‹ç®—å®Œæˆäº†,é‡Œé¢æ¶‰åŠåˆ°ä¸€äº›ç¯å¢ƒå˜é‡å’Œå‚æ•°çš„è®¾ç½®,ç¬”è€…å› ä¸ºè¿˜æ¶‰åŠåˆ°Swiftå’ŒOCæ··åˆæ‰“åŒ…,é—®é¢˜ç¨å¤šä¸€ç‚¹.å› ä¸ºä¸šåŠ¡éœ€æ±‚ä¸ä¸€æ ·,éœ€è¦è‡ªå·±å»å•ç‹¬è®¾ç½®,æœ‰ç–‘é—®çš„åœ°æ–¹å¯ä»¥ä¸€èµ·æ²Ÿé€šä¸€ä¸‹.</strong></p><h1 id="Xcode-Serveré›†æˆæ–¹æ¡ˆ"><a href="#Xcode-Serveré›†æˆæ–¹æ¡ˆ" class="headerlink" title="Xcode Serveré›†æˆæ–¹æ¡ˆ"></a>Xcode Serveré›†æˆæ–¹æ¡ˆ</h1><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;è¿™ä¸ªæ–¹æ¡ˆ,å°†ä¼šæŠŠä¸Šé¢ä¸‰ä¸ªè¿‡ç¨‹ç©¿æ’è¿›å»,ä¸åœ¨å•åˆ—å‡ºæ¥.ç½‘ä¸Šæœ‰å…¶ä»–æ–¹æ¡ˆæ˜¯macOS Server + Xcode Serveré›†æˆæ–¹æ¡ˆ,æœ¬æ–‡åªæ˜¯ç®€å•ä»‹ç»ä¸€ä¸‹é€šè¿‡Xcode Serveré›†æˆ</p><h3 id="æ‰“å¼€Xcode-Server"><a href="#æ‰“å¼€Xcode-Server" class="headerlink" title="æ‰“å¼€Xcode Server"></a>æ‰“å¼€Xcode Server</h3><p><img src="http://upload-images.jianshu.io/upload_images/1715253-4cd4f93cfe501b21.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ‰“å¼€Xcode Server.png"></p><h3 id="é…ç½®Xcode-Serverç®¡ç†å‘˜è´¦å·"><a href="#é…ç½®Xcode-Serverç®¡ç†å‘˜è´¦å·" class="headerlink" title="é…ç½®Xcode Serverç®¡ç†å‘˜è´¦å·"></a>é…ç½®Xcode Serverç®¡ç†å‘˜è´¦å·</h3><p><img src="http://upload-images.jianshu.io/upload_images/1715253-6753a803a134b39f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…ç½®Xcode Serverç®¡ç†å‘˜è´¦å·.png"></p><h3 id="åˆ›å»ºBot-å€¼å®ˆæœºå™¨äºº"><a href="#åˆ›å»ºBot-å€¼å®ˆæœºå™¨äºº" class="headerlink" title="åˆ›å»ºBot(å€¼å®ˆæœºå™¨äºº)"></a>åˆ›å»ºBot(å€¼å®ˆæœºå™¨äºº)</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;é…ç½®å®Œæˆå,ç„¶åé€šè¿‡Xcode-&gt;Product-&gt;Create Bot<img src="http://upload-images.jianshu.io/upload_images/1715253-53baf11c43225437.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åˆ›å»ºå€¼å®ˆæœºå™¨äºº.png"></p><h3 id="é…ç½®ä»“åº“åˆ†æ”¯"><a href="#é…ç½®ä»“åº“åˆ†æ”¯" class="headerlink" title="é…ç½®ä»“åº“åˆ†æ”¯"></a>é…ç½®ä»“åº“åˆ†æ”¯</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;é…ç½®ä»£ç ä»“åº“,Xcodeé›†æˆäº†Gitæ‰€ä»¥é’ˆå¯¹ä½ çš„é¡¹ç›®ä»“åº“ç›´æ¥æ·»åŠ åˆ†æ”¯å³å¯.<br><img src="http://upload-images.jianshu.io/upload_images/1715253-141e6996076bebbb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…ç½®ä»“åº“åˆ†æ”¯.png"></p><h3 id="ç¼–è¯‘æ‰“åŒ…å‚æ•°é…ç½®"><a href="#ç¼–è¯‘æ‰“åŒ…å‚æ•°é…ç½®" class="headerlink" title="ç¼–è¯‘æ‰“åŒ…å‚æ•°é…ç½®"></a>ç¼–è¯‘æ‰“åŒ…å‚æ•°é…ç½®</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åˆ†æ”¯æ·»åŠ å®Œæˆå,å°±å¯é…ç½®ç¼–è¯‘çš„ä¸€äº›é€‰é¡¹:scheme,ExportOptionsPlist,Configurationç­‰.<br><img src="http://upload-images.jianshu.io/upload_images/1715253-5bacde388ac4ab5e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç¼–è¯‘æ‰“åŒ…å‚æ•°é…ç½®.png"></p><h3 id="æ„å»ºè§¦å‘å™¨"><a href="#æ„å»ºè§¦å‘å™¨" class="headerlink" title="æ„å»ºè§¦å‘å™¨"></a>æ„å»ºè§¦å‘å™¨</h3><p><img src="http://upload-images.jianshu.io/upload_images/1715253-1f389e834485879e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ„å»ºè§¦å‘å™¨.png"><br><img src="http://upload-images.jianshu.io/upload_images/1715253-04787e6efa4abd74.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ„å»ºè§¦å‘å™¨.png"></p><h3 id="æ·»åŠ ç­¾åæ–‡ä»¶"><a href="#æ·»åŠ ç­¾åæ–‡ä»¶" class="headerlink" title="æ·»åŠ ç­¾åæ–‡ä»¶"></a>æ·»åŠ ç­¾åæ–‡ä»¶</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä¸‹ä¸€æ­¥æ·»åŠ è¯ä¹¦,æè¿°æ–‡ä»¶ç­‰,ä½œè€…è¿™é‡Œé€‰æ‹©çš„æ˜¯è‡ªåŠ¨ç­¾åæ¨¡å¼,å¦‚æœéœ€è¦å¯è‡ªå·±æŒ‡å®šç­¾åè¯ä¹¦,æè¿°æ–‡ä»¶ç­‰,è¿™é‡Œä¸å†ç»†è¯´.<br><img src="http://upload-images.jianshu.io/upload_images/1715253-24a9e3f9e9ab7c0f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ·»åŠ ç­¾åæ–‡ä»¶.png"></p><h3 id="æ·»åŠ ç¯å¢ƒå˜é‡"><a href="#æ·»åŠ ç¯å¢ƒå˜é‡" class="headerlink" title="æ·»åŠ ç¯å¢ƒå˜é‡"></a>æ·»åŠ ç¯å¢ƒå˜é‡</h3><p><img src="http://upload-images.jianshu.io/upload_images/1715253-bf5c804e22e172cb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ·»åŠ ç¯å¢ƒå˜é‡.png"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä¸‹ä¸€æ­¥å°±æ˜¯æ·»åŠ ç¼–è¯‘ä¹‹å‰å’Œç¼–è¯‘æ‰“åŒ…ä¹‹åçš„åŠ¨ä½œ</p><h3 id="æ·»åŠ æ‰“åŒ…åçš„è„šæœ¬å‘½ä»¤"><a href="#æ·»åŠ æ‰“åŒ…åçš„è„šæœ¬å‘½ä»¤" class="headerlink" title="æ·»åŠ æ‰“åŒ…åçš„è„šæœ¬å‘½ä»¤"></a>æ·»åŠ æ‰“åŒ…åçš„è„šæœ¬å‘½ä»¤</h3><p><img src="http://upload-images.jianshu.io/upload_images/1715253-200c086c7d6d92ac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ·»åŠ æ‰“åŒ…åçš„è„šæœ¬å‘½ä»¤.png"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;è¿™é‡Œä½ å¯ä»¥æŠŠæ‰“åŒ…ç»“æœä¸Šä¼ åˆ°æŒ‡å®šä½ç½®,è„šæœ¬å¯è‡ªè¡ŒæŸ¥æ‰¾.</p><h3 id="é›†æˆæ‰“åŒ…"><a href="#é›†æˆæ‰“åŒ…" class="headerlink" title="é›†æˆæ‰“åŒ…"></a>é›†æˆæ‰“åŒ…</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æœºå™¨äººåˆ›å»ºå®Œæˆåä¼šè‡ªåŠ¨è¿è¡Œç¼–è¯‘æ‰“åŒ…ä¸€æ¬¡,ä¸‹æ¬¡æ‰“åŒ…å¯ä»¥ç›´æ¥é€šè¿‡ç‚¹å‡»Integrateè§¦å‘æ‰“åŒ….<br><img src="http://upload-images.jianshu.io/upload_images/1715253-4ffe92eeb5c28e06.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é›†æˆæ‰“åŒ….png"></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>ä¸¤ç§æ–¹æ¡ˆ,æ•´ä¸ªè¿‡ç¨‹èµ°ä¸‹æ¥å¹¶ä¸æ˜¯å¾ˆå¤æ‚.è¿™é‡Œæé†’ä¸€ä¸‹,ç”±äºJenkinsæ‰“åŒ…é€šè¿‡è„šæœ¬å‘½ä»¤æ‰§è¡Œç¼–è¯‘æ‰“åŒ…,è¿™ä¸ªåˆä¾èµ–äºä¸€äº›ç¯å¢ƒå˜é‡å’Œå‚æ•°,å¦‚æœä¸€äº›æ’ä»¶å’Œå‚æ•°å˜äº†,IDEæ›´æ–°äº†,ç³»ç»Ÿæ›´æ–°äº†ç­‰ç­‰åŸå› ,è¿™äº›å¾ˆå®¹æ˜“é€ æˆæ‰“åŒ…å¤±è´¥,ç¬”è€…ç»å†å¤šæ¬¡äº†,ä¸€èˆ¬å°±æ˜¯å…ˆæŠŠå‘½ä»¤æ‹¿åˆ°ç»ˆç«¯é‡Œé¢ç¼–è¯‘æ‰“åŒ…è¯•ä¸€ä¸‹,æ’é™¤ç¼–è¯‘å‘½ä»¤é—®é¢˜,ç„¶ååœ¨è°ƒè¯•Jenkinsç¯å¢ƒ.æ€»ç»“ä¸‹æ¥å°±æ˜¯é‡åˆ°é—®é¢˜æ—¶ä¸è¦ç€æ€¥,æ…¢æ…¢åˆ†æ,ä¸€ç‚¹ä¸€ç‚¹è°ƒè¯•,æ€»ä¼šè§£å†³çš„.</strong></p><p>æœ€åæ‰“ä¸ªå¹¿å‘Š:<br>æ¨¡ä»¿æ¨ç‰¹å®¢æˆ·ç«¯(çº¯Swiftå¼€å‘,developåˆ†æ”¯):<br><a href="https://github.com/waitwalker/MyTwitter" target="_blank" rel="noopener">https://github.com/waitwalker/MyTwitter</a><br>é’ˆå¯¹è¿™ä¸ªå®¢æˆ·ç«¯ç®€å•ç”¨Pythonå†™äº†å‡ ä¸ªæ¥å£:<br><a href="https://github.com/waitwalker/MyTwitterAPI" target="_blank" rel="noopener">https://github.com/waitwalker/MyTwitterAPI</a><br>æ–‡ç« åœ°å€:<a href="https://www.jianshu.com/p/42ed698c57ad,å› ä¸ºä¸€ç›´åœ¨å†™code,æ–‡ç« æ¯”è¾ƒç³™,è¿˜æ²¡æ¥åŠæ•´ç†,æŠ±æ­‰" target="_blank" rel="noopener">https://www.jianshu.com/p/42ed698c57ad,å› ä¸ºä¸€ç›´åœ¨å†™code,æ–‡ç« æ¯”è¾ƒç³™,è¿˜æ²¡æ¥åŠæ•´ç†,æŠ±æ­‰</a>!</p>]]></content>
      
      
      <categories>
          
          <category> iOSå¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> CI </tag>
            
            <tag> æŒç»­é›†æˆ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
